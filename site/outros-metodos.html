<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>11&nbsp; Outros Métodos de Aprendizado de Máquina – APRENDIZADO DE MÁQUINA COM R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./referencias.html" rel="next">
<link href="./metodos-de-treino-baseados-em-arvore.html" rel="prev">
<link href="./uff-brasao.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./outros-metodos.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Outros Métodos de Aprendizado de Máquina</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">APRENDIZADO DE MÁQUINA COM R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/CienciaDeDadosUFF/cienciadedadosuff2.github.io" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./APRENDIZADO-DE-MÁQUINA-COM-R.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bem-vindo</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tipos-am.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Tipos de Aprendizado de Máquina</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Predição</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./design-pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Design de predição</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./erros-amostrais.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Erros Amostrais</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./caret.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Avaliando Preditores - Introdução ao Pacote Caret</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cross-valid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cross Validation (Validação Cruzada)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./comp-func.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Comparando Funções Preditoras</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pre-processamento.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Pré-processamento</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./metodos-de-treino-baseados-em-arvore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Métodos de Treino Baseados em Árvore</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./outros-metodos.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Outros Métodos de Aprendizado de Máquina</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./referencias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Referências</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#support-vector-machine-svm" id="toc-support-vector-machine-svm" class="nav-link active" data-scroll-target="#support-vector-machine-svm"><span class="header-section-number">11.1</span> Support Vector Machine (SVM)</a>
  <ul class="collapse">
  <li><a href="#em-classificação" id="toc-em-classificação" class="nav-link" data-scroll-target="#em-classificação"><span class="header-section-number">11.1.1</span> em Classificação</a></li>
  <li><a href="#em-regressão" id="toc-em-regressão" class="nav-link" data-scroll-target="#em-regressão"><span class="header-section-number">11.1.2</span> em Regressão</a></li>
  <li><a href="#svm-com-a-função-svm-do-pacote-e1071" id="toc-svm-com-a-função-svm-do-pacote-e1071" class="nav-link" data-scroll-target="#svm-com-a-função-svm-do-pacote-e1071"><span class="header-section-number">11.1.3</span> SVM com a função svm() do pacote e1071</a></li>
  <li><a href="#svm-com-a-função-ksvm-do-pacote-kernlab" id="toc-svm-com-a-função-ksvm-do-pacote-kernlab" class="nav-link" data-scroll-target="#svm-com-a-função-ksvm-do-pacote-kernlab"><span class="header-section-number">11.1.4</span> SVM com a função ksvm() do pacote kernlab</a></li>
  <li><a href="#svm-com-a-função-train-do-pacote-caret" id="toc-svm-com-a-função-train-do-pacote-caret" class="nav-link" data-scroll-target="#svm-com-a-função-train-do-pacote-caret"><span class="header-section-number">11.1.5</span> SVM com a função train() do pacote caret</a></li>
  </ul></li>
  <li><a href="#k-nearest-neighbors-knn" id="toc-k-nearest-neighbors-knn" class="nav-link" data-scroll-target="#k-nearest-neighbors-knn"><span class="header-section-number">11.2</span> K-Nearest Neighbors (KNN)</a>
  <ul class="collapse">
  <li><a href="#em-classificação-1" id="toc-em-classificação-1" class="nav-link" data-scroll-target="#em-classificação-1"><span class="header-section-number">11.2.1</span> Em Classificação</a></li>
  <li><a href="#em-regressão-1" id="toc-em-regressão-1" class="nav-link" data-scroll-target="#em-regressão-1"><span class="header-section-number">11.2.2</span> Em Regressão</a></li>
  <li><a href="#knn-com-o-pacote-fnn" id="toc-knn-com-o-pacote-fnn" class="nav-link" data-scroll-target="#knn-com-o-pacote-fnn"><span class="header-section-number">11.2.3</span> KNN com o pacote FNN</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/CienciaDeDadosUFF/cienciadedadosuff2.github.io/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Outros Métodos de Aprendizado de Máquina</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Neste capítulo estudaremos alguns métodos não baseados em árvores que também são muito importantes e utilizados em machine learning: Support Vector Machine (SVM) e K-Nearest Neighbors (KNN). Veremos como os modelos funcionam na teoria com alguns exemplos e em seguida iremos implementá-los computacionalmente utilizando a linguagem R.</p>
<section id="support-vector-machine-svm" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="support-vector-machine-svm"><span class="header-section-number">11.1</span> Support Vector Machine (SVM)</h2>
<p>O <em>Support Vector Machine</em> - ou Máquina de Vetores de Suporte - é um algoritmo de aprendizado supervisionado que analisa os dados e os divide em diferentes grupos, de acordo com seus padrões, para assim classificar as observações. É mais utilizado em problemas de classificação, o qual será o maior foco deste capítulo, mas também pode ser utilizado para regressão.</p>
<section id="em-classificação" class="level3" data-number="11.1.1">
<h3 data-number="11.1.1" class="anchored" data-anchor-id="em-classificação"><span class="header-section-number">11.1.1</span> em Classificação</h3>
<p>Para entender como esse método funciona, vamos utilizar a seguinte situação: queremos verificar se as vendas de um produto em diferentes mercados foram altas ou baixas baseado nos gastos com publicidade desse produto para TV. Para tal temos a amostra treino abaixo:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/svm1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Podemos observar que os mercados que possuíram um maior investimento em publicidade tiveram maiores vendas, estando naturalmente agrupados mais à direita do gráfico. O objetivo do algoritmo é criar um classificador no formato de um separador, ou seja, um ponto que melhor separe os dados entre os que foram classificados como baixas ou altas vendas, de acordo com os gastos com publicidade.</p>
<p>Esse separador é criado como sendo o ponto médio entre os elementos de cada grupo. Dessa forma, é natural perceber que o melhor separador para a amostra é a média entre o mercado que obteve a maior venda dentre os que tiveram baixas vendas e o mercado que obteve a menor venda dentre os que tiveram altas vendas (as bordas de cada agrupamento).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/svm2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Assim, quando novas amostras chegarem para serem analisadas, podemos classificá-las de acordo com nosso classificador. Se ela tiver à esquerda dele será classificada como vendas baixas e se tiver à direita como vendas altas.</p>
<p><strong>Definição 1</strong>: a menor distância entre o classificador e as observações utilizadas para calculá-lo é chamada de <em>margem</em>.</p>
<p>Como nosso classificador está no ponto médio entre os dois elementos da borda de cada grupo, a margem é a distância de uma dessas observações até ele. Caso ele estivesse mais à esquerda, por exemplo, a margem seria a distância entre ele e o elemento que está na borda do agrupamento das vendas baixas.</p>
<p><strong>Definição 2</strong>: o classificador que dá a maior margem para fazer classificações é chamado de <strong>classificador de margem máxima</strong>.</p>
<p>O classificador de margem máxima performa bem em bases onde os elementos estejam bem agrupados, mas ele se torna um classificador falho quando a base possui outliers. Por exemplo, se um dos mercados do nosso conjunto treino gastou pouco com publicidade para TV, mas obteve vendas altas, o classificador de margem máxima estaria muito próximo ao agrupamento das vendas baixas.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/svm3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Dessa forma, novas amostras à direita do classificador seriam classificadas como vendas altas, mesmo que elas estivessem mais próximas ao grupo das vendas baixas. Ou seja, isso implicaria em muitos erros de classificação.</p>
<p>Para melhorarmos essa situação precisamos de um classificador que não seja tão sensível a outliers. Para isso teremos que permitir alguns erros de classificação no conjunto treino, aumentando o viés do classificador para que, assim, quando o algoritmo receber novas amostras, a variância dele seja menor.</p>
<p><strong>Definição 3</strong>: Quando é utilizado um classificador que permite erros de classificação, a distância entre ele e os elementos utilizados para obtê-lo é chamada de <strong>margem suave</strong>.</p>
<p>Como temos várias margens suaves a se considerar, o algoritmo utiliza cross validation para determinar qual é a melhor delas, escolhendo o melhor separador para ser utilizado.</p>
<p><strong>Definição 4</strong>: As observações utilizadas para calcular a margem suave são chamadas de <strong>support vectors</strong> (vetores de suporte).</p>
<p><strong>Definição 5</strong>: O classificador escolhido quando é utilizado a melhor margem suave é chamado de <strong>classificador de margem suave</strong> ou <strong>support vector classifier</strong> (classificador de vetor de suporte).</p>
<p>Vamos adicionar agora mais uma variável ao nosso problema. Queremos analisar as vendas do produto com base nos gastos com publicidade para TV e nos gastos com publicidade para o rádio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>vendas <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">"sales.xlsx"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>vendas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   TV    radio newspaper sales
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;
 1 8.6   2.1   1         low  
 2 75.5  10.8  6         low  
 3 107.4 14    10.9      low  
 4 120.2 19.6  11.6      low  
 5 120.5 28.5  14.2      low  
 6 191.1 28.7  18.2      high 
 7 248.4 30.2  20.3      high 
 8 281.4 39.6  55.8      high 
 9 283.6 42    66.2      high 
10 290.7 4.1   8.5       high </code></pre>
</div>
</div>
<p>Note que à medida que os gastos com publicidade nas duas mídias aumentam, as vendas do produto também aumentam. Vamos verificar graficamente o comportamento dessas variáveis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Anexando pacote: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Os seguintes objetos são mascarados por 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Os seguintes objetos são mascarados por 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando a variável resposta em fator:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>vendas<span class="sc">$</span>sales <span class="ot">=</span> <span class="fu">as.factor</span>(vendas<span class="sc">$</span>sales)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando as demais variáveis em números:</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>vendas <span class="ot">=</span> <span class="fu">mutate_if</span>(vendas, is.character, as.numeric)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Desenhando o gráfico:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>vendas <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TV, <span class="at">y =</span> radio, <span class="at">color =</span> sales)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Vendas de um Produto em Diferentes Mercados"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Publicidade para TV"</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Publicidade para Radio"</span>) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"orange"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Repare que as amostras, assim como anteriormente, estão agrupadas em clusters. E, novamente, para escolher o melhor classificador, o algoritmo irá utilizar cross validation para determinar qual é a melhor margem suave. Como o problema possui duas variáveis, o support vector classifier será uma linha dividindo os dois grupos.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/unnamed-chunk-214-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Assim, as novas amostras que estiverem à direita da linha serão classificadas como vendas altas, e as que estiverem à esquerda como vendas baixas.</p>
<p>Agora vamos adicionar uma terceira variável, ou seja, vamos levar em conta também a terceira coluna da base de dados, os gastos com publicidade para os jornais. Vamos verificar o comportamento das variáveis graficamente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pacote para plotar gráfico de pontos em 3 dimensões:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scatterplot3d)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Escolhendo as cores dos pontos:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"orange"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorindo-os de acordo com as classificações das vendas:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">=</span> cores[<span class="fu">as.numeric</span>(vendas<span class="sc">$</span>sales)]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Desenhando o gráfico:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot3d</span>(vendas<span class="sc">$</span>TV, vendas<span class="sc">$</span>radio, vendas<span class="sc">$</span>newspaper, <span class="at">color =</span> cores, <span class="at">pch =</span> <span class="dv">19</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Publicidade para TV"</span>, <span class="at">ylab =</span> <span class="st">"Publicidade para Radio"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">zlab =</span> <span class="st">"Publicidade para Jornais"</span>, <span class="at">main =</span> <span class="st">"Vendas de um Produto em Diferentes Mercados"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando legenda ao gráfico:</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Vendas baixas"</span>, <span class="st">"Vendas altas"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"blue"</span>), <span class="at">pch =</span> <span class="dv">19</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">horiz =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note que, novamente, os dados estão agrupados naturalmente. Quando a base de dados é tridimensional, o classificador de vetor de suporte é um plano e classificamos as novas observações determinando em qual lado do plano elas se encontram.</p>
<p>E se a base de dados possuí-se mais uma variável, por exemplo, publicidade para internet? Nesse caso, o classificador seria um <strong>hiperplano</strong>. Matematicamente, em um espaço p-dimensional, um hiperplano é definido como um subespaço plano de dimensão p-1. Ele é a generalização do plano em diferentes números de dimensões. Quando a base é unidimensional, o classificador de vetor de suporte é um ponto, ou seja, um hiperplano de dimensão 0. Quando a base é bidimensional, o classificador de vetor de suporte é uma linha, ou seja, um hiperplano de dimensão 1. E quando a base é tridimensional, o classificador de vetor de suporte é um plano comum (hiperplano de dimensão 2). Então, generalizando, quando a base é p-dimensional, o classificador de vetor de suporte é um hiperplano de dimensão p-1.</p>
<p>Em suma, support vector classifiers são ótimos classificadores, mas eles só performam bem em base de dados linearmente separáveis. Por exemplo, suponha que a amostra abaixo seja o nosso conjunto treino.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">"sales2.xlsx"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
      TV sales
   &lt;dbl&gt; &lt;chr&gt;
 1 230.  high 
 2  44.5 low  
 3  17.2 high 
 4 152.  low  
 5 181.  low  
 6   8.7 high 
 7  57.5 low  
 8 120.  low  
 9   8.6 high 
10 200.  high 
11  66.1 low  
12 215.  high 
13  23.8 high 
14  97.5 low  
15 204.  high 
16 195.  high </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando a variável de interesse em fator:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>v<span class="sc">$</span>sales <span class="ot">=</span> <span class="fu">as.factor</span>(v<span class="sc">$</span>sales)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando a variável com os valores dos gastos com publicidade para TV em números:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>v<span class="sc">$</span>TV <span class="ot">=</span> <span class="fu">as.numeric</span>(v<span class="sc">$</span>TV)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico das vendas baseado na puclicidade para TV:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TV, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">color =</span> sales)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Publicidade para TV"</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Vendas de um Produto em Diferentes Mercados"</span>) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Utilizar um classificador de vetor de suporte seria inviável nesse caso, visto que onde quer que ele se encontre existiriam muitos erros de classificação. Para esse tipo de situação em que os dados não são linearmente separáveis, que é o mais habitual de se encontrar na realidade, precisamos utilizar support vector machines.</p>
<p><strong>Definição 6</strong>: Support vector machine (máquina de vetores de suporte) é uma extensão do support vector classifier que resulta da ampliação do espaço característico de um jeito específico, utilizando kernels.</p>
<p>Em outras palavras, o que o support vector machine (máquina de vetores de suporte) faz é aumentar a dimensão da nossa base de dados por meio de funções (conhecidas como kernels) para que a base se torne linearmente separável, tornando possível o uso dos classificadores de vetores de suporte. Por exemplo, vamos criar uma nova variável definida como sendo os valores da variável que representa os gastos com publicidade para TV elevados ao quadrado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando a nova variável com os valores elevados ao quadrado:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> v <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">TV2 =</span> TV<span class="sc">**</span><span class="dv">2</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico das vendas baseado nos valores da publicidade e publicidade ao quadrado:</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TV, <span class="at">y =</span> TV2, <span class="at">color =</span> sales)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Publicidade para TV"</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Publicidade para TV ao quadrado"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Vendas de um Produto em Diferentes Mercados"</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Repare que, aumentando a dimensão da nossa base de 1 para 2 com a transformação que eleva os valores da publicidade ao quadrado, a nossa base agora se tornou linearmente separável. Então podemos utilizar um classificador de vetor de suporte no formato de uma linha para separar os dados.</p>
<p>Assim, quando uma nova observação chegar, será calculado o valor da sua publicidade para TV ao quadrado e, de acordo com o lugar que esse valor ficar em relação a linha, a observação será classificada como vendas baixas ou vendas altas. E, resumidamente, é dessa forma que o SVM opera para todas as bases de dados.</p>
<p>Por último, mas não menos importante, para escolher as funções que tornem a base possível de ser separada, o SVM utiliza as funções kernel.</p>
<p>A função kernel é uma função que computa as relações entre cada par de observações, e essas relações são utilizadas afim de encontrar um classificador de vetor de suporte. Ela é a responsável por aumentar a dimensão da base de dados por meio das transformações que a tornem linearmente separável.</p>
<p>Denota-se a função kernel como <span class="math inline">\(K(x, y)\)</span>, onde x e y se referem a duas diferentes observações no conjunto de dados. O kernel utilizado no exemplo acima foi o polinomial. Juntamente com esse, os mais utilizados são os lineares, radiais e sigmoid. Um parâmetro presente em todos os kernels (exceto o linear) é o <span class="math inline">\(\gamma\)</span>. cuja função é escalar a quantidade de influência que duas observações têm uma sobre a outra. Quanto maior o <span class="math inline">\(\gamma\)</span>, menor a influência.</p>
<p><strong>Linear:</strong></p>
<div style="text-align: center;">
<p><span class="math inline">\(K(x, y) = x^Ty\)</span></p>
</div>
<p>Nada mais é do que um produto vetorial entre as observações. É utilizados quando a base de dados já é, naturalmente, linearmente separável.</p>
<p><strong>Polinomial:</strong></p>
<div style="text-align: center;">
<p><span class="math inline">\(K(x, y) = [\gamma(x^Ty) + c]^d\)</span></p>
</div>
<p>onde:</p>
<ul>
<li><p>c é o parâmetro de penalidade do modelo, o parâmetro que controla seu ajuste. Para grandes valores de c, o algoritmo não pode classificar observações do conjunto treino de forma errada.</p></li>
<li><p>d determina o grau do polinômio.</p></li>
</ul>
<p>Como o nome sugere, ele utiliza uma transformação polinomial nos dados para torná-los linearmente separáveis. Para escolher os valores do c e do d o mais recomendado é utilizar cross validation.</p>
<p><strong>Radial:</strong></p>
<p>O kernel radial, também conhecido como kernel RBF (radial basis function), é comumente o kernel mais utilizado. Ele encontra classificadores de vetores de suporte em infinitas dimensões, por isso não é possível visualizá-lo graficamente. Seu comportamento se resume a separar as amostras do conjunto treino em círculos, de acordo com seus agrupamentos. Assim, a classificação das novas observações é altamente influenciada pelas observações que estão próximas a ela, e poucamente influenciada pelas que estão distantes. Sua fórmula é dada por:</p>
<div style="text-align: center;">
<p><span class="math inline">\(K(x, y) = e^{-^\gamma(\|\|x-y\|\|2)}\)</span></p>
</div>
<p>Onde <span class="math inline">\(||x-y||\)</span> é a <strong>norma</strong> ou comprimento do vetor x-y.</p>
<p><strong>Sigmoid:</strong></p>
<p>O kernel sigmoid, também conhecido como kernel da tangente hiperbólica, é bastante popular por ser proveniente dos estudos das redes neurais, e por ter um bom desempenho no geral. Sua fórmula é dada por:</p>
<div style="text-align: center;">
<p><span class="math inline">\(K(x, y) = tanh(\gamma[x^Ty] + c)\)</span></p>
</div>
<p>onde, assim como no kernel polinomial, o parâmetro c é o parâmetro de penalidade do modelo, o parâmetro que controla seu ajuste.</p>
</section>
<section id="em-regressão" class="level3" data-number="11.1.2">
<h3 data-number="11.1.2" class="anchored" data-anchor-id="em-regressão"><span class="header-section-number">11.1.2</span> em Regressão</h3>
<p>O support vector machine para regressão - mais conhecido como support vector regression (SVR) - usa os mesmos princípios que o SVM para classificação, com algumas poucas diferenças. Para começar, como não temos classes nos dados, o objetivo não é tentar agrupá-los de acordo com elas, visto que agora o que queremos prever são números reais.</p>
<p>Vamos supor que queremos prever as vendas de um produto em unidades monetárias (U.M.) em diferentes mercados baseado nos gastos com publicidade para TV (em U.M.) que o mercado teve com esse produto. Para tal, suponha que a amostra abaixo seja nossa amostra de treino.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/svr1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Note que agora é necessário termos um eixo para representar a variável de interesse. Podemos reparar também que, em geral, à medida que os gastos com publicidade aumentam, as vendas também aumentam.</p>
<p>Ao invés de encontrar uma linha para separar os dados, o objetivo do SVR é encontrar uma linha com o objetivo de ajustar os dados sobre ela. A ideia é parecida com a de regressão linear simples, exceto pelo fato de que, ao invés de minimizar a soma dos quadrados dos resíduos, seu objetivo é minimizar a norma do vetor de coeficiente, um assunto que está fora dos escopos deste material. Para mais informações, consulte o livro The Elements of Statistical Learning.</p>
<p>Para definirmos o quanto de erro é aceitável no nosso modelo, utilizamos o parâmetro <span class="math inline">\(\epsilon\)</span>. A figura abaixo apresenta a linha azul que representa a linha de melhor ajuste de acordo com a margem de erro escolhida (<span class="math inline">\(\epsilon\)</span>), representada pelas linhas verdes.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/svr3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>O algoritmo ajusta o modelo da melhor forma possível, mas ainda assim alguns pontos ainda ficam fora da margem de erro. Para definirmos a tolerância que o algoritmo deve ter desse número de pontos que ficam fora da margem utilizamos o parâmetro c.&nbsp;Conforme c aumenta, a tolerância do número de pontos também aumenta, e quando c é pequeno a tolerância também fica pequena.</p>
<p>Dependendo dos valores escolhidos para o <span class="math inline">\(\epsilon\)</span> e para o c o algoritmo pode não ser capaz de encontrar um regressor para os dados. Por exemplo, se escolhermos um c e um <span class="math inline">\(\epsilon\)</span> muito pequenos quando as observações são muito dispersas. É preciso cuidado.</p>
<p>Generalizando para maiores dimensões, ao invés do SVR utilizar uma linha para ajustar os dados, ele utiliza hiperplanos. Assim, quando uma nova observação chegar, seu valor de saída será predito de acordo com as coordenadas do hiperplano em que ela se encontra.</p>
</section>
<section id="svm-com-a-função-svm-do-pacote-e1071" class="level3" data-number="11.1.3">
<h3 data-number="11.1.3" class="anchored" data-anchor-id="svm-com-a-função-svm-do-pacote-e1071"><span class="header-section-number">11.1.3</span> SVM com a função svm() do pacote e1071</h3>
<p>Vamos utilizar a base de dados <strong>mtcars</strong> do pacote básico do R. Essa base contém algumas informações de desempenho e design que permitem comparar diferentes modelos de automóveis, como mpg que indica a quantidade de milhas que é possivel percorrer com um galão (miles per gallon), hp que indica a potência em cavalos (horsepower), wt indica o peso em libras (weight) e qsec que indica o tempo em segundo pra percorrer 1/4 de milha (quarter mile time in seconds). Nossa variável de interesse é am que indica se o câmbio é automático ou manual.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: lattice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>am <span class="ot">=</span> <span class="fu">factor</span>(mtcars<span class="sc">$</span>am, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"automatic"</span>,<span class="st">"manual"</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs        am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0    manual    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0    manual    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1    manual    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1 automatic    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0 automatic    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1 automatic    3    1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>noTreino <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(<span class="at">y =</span> mtcars<span class="sc">$</span>am, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> F)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>treino <span class="ot">=</span> mtcars[noTreino,]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> mtcars[<span class="sc">-</span>noTreino,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="utilizando-kernel-linear" class="level4" data-number="11.1.3.1">
<h4 data-number="11.1.3.1" class="anchored" data-anchor-id="utilizando-kernel-linear"><span class="header-section-number">11.1.3.1</span> Utilizando Kernel linear</h4>
<p>Para melhor visualização, vamos utilizar apenas duas variáveis explicativas no começo. Observe essas duas variáveis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> treino, <span class="fu">aes</span>(<span class="at">x =</span> qsec, <span class="at">y =</span> wt, <span class="at">color =</span> am)) <span class="sc">+</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"darkolivegreen3"</span>, <span class="st">"brown2"</span>)) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Parece ser possível separar as observações em dois grupos, manual e automático, apenas com uma linha. Vamos tentar treinar um modelo de svm linear então. Para isso, utilizaremos a função svm().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(e1071)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># treinando o modelo</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">645</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>svmfit <span class="ot">=</span> e1071<span class="sc">::</span><span class="fu">svm</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, wt, qsec),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">kernel =</span> <span class="st">"linear"</span>, <span class="at">cost =</span> <span class="dv">1</span>, <span class="at">scale =</span> T)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>svmfit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svm(formula = am ~ ., data = select(treino, am, wt, qsec), kernel = "linear", 
    cost = 1, scale = T)


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  linear 
       cost:  1 

Number of Support Vectors:  10</code></pre>
</div>
</div>
<ul>
<li><p>kernel = indica o tipo de kernel. Os mais comuns são ‘linear’, ‘polynomial’ e ‘radial’ (sendo esse último o default).</p></li>
<li><p>cost = quantifica a penalidade associada a uma predição incorreta. Default=1.</p></li>
<li><p>scale = se TRUE (default), padroniza as variáveis.</p></li>
<li><p>gamma = parâmetro usado no cálculo exceto quando o kernel é linear. Default = $ $</p></li>
<li><p>coef0 = parâmetro usado no cálculo quando o kernel é polinomial. Default=0.</p></li>
<li><p>degree = usado quando o kernel é polinomial. Indica o grau do polinômio. Default=3.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualizando o modelo</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(svmfit, <span class="fu">select</span>(treino, am, qsec, wt), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"cornflowerblue"</span>, <span class="st">"darkred"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As observações em vermelho, são as rotuladas como manuais, e as pretas como automaticas.</p>
<p>Segundo nosso modelo toda nova observação que estiver acima da linha, parte azul, será classificada/predita como automatico. Caso contrário, classificada como manual.</p>
<p>Por fim, as observações com forma de “X” são as que foram usadas como vetores de suporte (se observar a descrição do modelo, verá que são 9 os vetores de suporte).</p>
<p>Agora, vamos avaliar nosso preditor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># realizando a predicao sob o conjunto de teste</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>predicao <span class="ot">=</span> <span class="fu">predict</span>(svmfit, <span class="fu">select</span>(teste, am, wt, qsec))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># obtendo a matriz de confusao</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predicao, <span class="at">reference =</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  automatic manual
  automatic         5      0
  manual            0      3
                                     
               Accuracy : 1          
                 95% CI : (0.6306, 1)
    No Information Rate : 0.625      
    P-Value [Acc &gt; NIR] : 0.02328    
                                     
                  Kappa : 1          
                                     
 Mcnemar's Test P-Value : NA         
                                     
            Sensitivity : 1.000      
            Specificity : 1.000      
         Pos Pred Value : 1.000      
         Neg Pred Value : 1.000      
             Prevalence : 0.625      
         Detection Rate : 0.625      
   Detection Prevalence : 0.625      
      Balanced Accuracy : 1.000      
                                     
       'Positive' Class : automatic  
                                     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outra forma de obter a precisao</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(predicao <span class="sc">==</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Agora, na hora de treinar o modelo, note que utilizamos cost=1. Mas e se esse não for o melhor custo? Podemos utilizar a função tune() também do pacote e1071 para testar vários valores de parâmetros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">645</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>tunefit <span class="ot">=</span> e1071<span class="sc">::</span><span class="fu">tune</span>(svm, am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, wt),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">kernel =</span> <span class="st">"linear"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ranges =</span> <span class="fu">list</span>(<span class="at">cost =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">10</span>)))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>tunefit<span class="sc">$</span>best.model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
best.tune(METHOD = svm, train.x = am ~ ., data = select(treino, am, 
    qsec, wt), ranges = list(cost = seq(0.1, 2, length = 10)), kernel = "linear")


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  linear 
       cost:  0.3111111 

Number of Support Vectors:  15</code></pre>
</div>
</div>
<p>Dessa forma, foram feitos 10 treinamentos (cost = 0.1, 0.31, 0.52, 0.73, 0.94, 1.16, 1.37, 1.58, 1.79, 2) e concluído que o melhor (maior precisão) foi quando o custo era 0.31.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># realizando a predicao sob o conjunto de teste</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>predicao <span class="ot">=</span> <span class="fu">predict</span>(tunefit<span class="sc">$</span>best.model, <span class="fu">select</span>(teste, am, wt, qsec))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># obtendo a matriz de confusao</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predicao, <span class="at">reference =</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  automatic manual
  automatic         5      0
  manual            0      3
                                     
               Accuracy : 1          
                 95% CI : (0.6306, 1)
    No Information Rate : 0.625      
    P-Value [Acc &gt; NIR] : 0.02328    
                                     
                  Kappa : 1          
                                     
 Mcnemar's Test P-Value : NA         
                                     
            Sensitivity : 1.000      
            Specificity : 1.000      
         Pos Pred Value : 1.000      
         Neg Pred Value : 1.000      
             Prevalence : 0.625      
         Detection Rate : 0.625      
   Detection Prevalence : 0.625      
      Balanced Accuracy : 1.000      
                                     
       'Positive' Class : automatic  
                                     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outra forma de obter a precisao</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(predicao <span class="sc">==</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="utilizando-kernel-polinomial" class="level4" data-number="11.1.3.2">
<h4 data-number="11.1.3.2" class="anchored" data-anchor-id="utilizando-kernel-polinomial"><span class="header-section-number">11.1.3.2</span> Utilizando Kernel polinomial</h4>
<p>Agora, observe o gráfico novamente</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/unnamed-chunk-227-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Será que se usarmos uma curva no lugar de uma reta para separar os grupos, teriamos um modelo melhor? Vamos treinar um modelo usando o kernel <strong>polinomial</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">987</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>svmfit.p <span class="ot">=</span> <span class="fu">svm</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, wt, qsec),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">kernel =</span> <span class="st">"polynomial"</span>, <span class="at">cost =</span> <span class="dv">1</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">gamma=</span><span class="fl">0.3</span>, <span class="at">coef0=</span><span class="fl">0.1</span>, <span class="at">degree=</span><span class="dv">3</span>, <span class="at">scale =</span> T)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>svmfit.p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svm(formula = am ~ ., data = select(treino, am, wt, qsec), kernel = "polynomial", 
    cost = 1, gamma = 0.3, coef0 = 0.1, degree = 3, scale = T)


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  polynomial 
       cost:  1 
     degree:  3 
     coef.0:  0.1 

Number of Support Vectors:  19</code></pre>
</div>
</div>
<p>Note que com o kernel polinomial utilizamos mais parâmetros. São eles gamma, coef0 e degree. Naquela fórmula explicada mais acima (<span class="math inline">\(K(x, y) = [\gamma(x^Ty) + c]^d\)</span>), esses parâmetros são respectivamente <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(r\)</span> e <span class="math inline">\(d\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( svmfit.p, <span class="fu">select</span>(treino, am, wt, qsec), </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="fu">c</span>(<span class="st">"cornflowerblue"</span>, <span class="st">"darkred"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Da mesma forma, podemos usar a função tune para testar mais de um valor em cada parâmetro.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">59</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>tunefit.p <span class="ot">=</span> <span class="fu">tune</span>(svm, am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, wt),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">kernel =</span> <span class="st">"polynomial"</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ranges =</span> <span class="fu">list</span>(<span class="at">cost   =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">50</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">gamma  =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">coef0  =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">degree =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)))</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>tunefit.p<span class="sc">$</span>best.model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
best.tune(METHOD = svm, train.x = am ~ ., data = select(treino, am, 
    qsec, wt), ranges = list(cost = c(0.001, 0.01, 0.1, 1, 5, 10, 
    50), gamma = c(0.5, 1, 2, 3, 4), coef0 = c(0, 0.1, 0.5, 1), degree = c(1, 
    2, 3)), kernel = "polynomial")


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  polynomial 
       cost:  50 
     degree:  3 
     coef.0:  0.5 

Number of Support Vectors:  7</code></pre>
</div>
</div>
<p>Com isso, podemos avaliar o modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># realizando a predicao sob o conjunto de teste</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>predicao <span class="ot">=</span> <span class="fu">predict</span>(tunefit.p<span class="sc">$</span>best.model,  <span class="fu">select</span>(teste, am, wt, qsec))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># obtendo a matriz de confusao</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predicao, <span class="at">reference =</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  automatic manual
  automatic         5      0
  manual            0      3
                                     
               Accuracy : 1          
                 95% CI : (0.6306, 1)
    No Information Rate : 0.625      
    P-Value [Acc &gt; NIR] : 0.02328    
                                     
                  Kappa : 1          
                                     
 Mcnemar's Test P-Value : NA         
                                     
            Sensitivity : 1.000      
            Specificity : 1.000      
         Pos Pred Value : 1.000      
         Neg Pred Value : 1.000      
             Prevalence : 0.625      
         Detection Rate : 0.625      
   Detection Prevalence : 0.625      
      Balanced Accuracy : 1.000      
                                     
       'Positive' Class : automatic  
                                     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outra forma de obter a precisao</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(predicao <span class="sc">==</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="utilizando-kernel-radial" class="level4" data-number="11.1.3.3">
<h4 data-number="11.1.3.3" class="anchored" data-anchor-id="utilizando-kernel-radial"><span class="header-section-number">11.1.3.3</span> Utilizando Kernel radial</h4>
<p>Observe agora a distribuição das variáveis mpg e qsec</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/unnamed-chunk-232-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Vamos treinar um modelo com kernel radial utilizando elas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">751</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>svmfit.r <span class="ot">=</span> <span class="fu">svm</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, mpg, qsec),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">kernel =</span> <span class="st">"radial"</span>, <span class="at">gamma=</span><span class="fl">0.5</span>, <span class="at">cost =</span> <span class="dv">10</span>, <span class="at">scale =</span> T)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>svmfit.r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svm(formula = am ~ ., data = select(treino, am, mpg, qsec), kernel = "radial", 
    gamma = 0.5, cost = 10, scale = T)


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  radial 
       cost:  10 

Number of Support Vectors:  10</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(svmfit.r, <span class="fu">select</span>(treino, am, qsec, mpg), </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="fu">c</span>(<span class="st">"cornflowerblue"</span>, <span class="st">"darkred"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Para o modelo radial, precisamos informar apenas o parâmetro <span class="math inline">\(\gamma\)</span> (O mesmo <span class="math inline">\(\gamma\)</span> da fórmula <span class="math inline">\(K(x, y) = e^{-^\gamma(\|\|x-y\|\|2)}\)</span>). Vamos testar com outros valores de parâmetros:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">751</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>tunefit.r <span class="ot">=</span> <span class="fu">tune</span>(svm, am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, mpg),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">kernel =</span> <span class="st">"radial"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ranges =</span> <span class="fu">list</span>(<span class="at">cost =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">100</span>),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">gamma =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>tunefit.r<span class="sc">$</span>best.model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
best.tune(METHOD = svm, train.x = am ~ ., data = select(treino, am, 
    qsec, mpg), ranges = list(cost = c(0.001, 0.01, 0.1, 1, 5, 10, 
    100), gamma = c(0.5, 1, 2, 3, 4)), kernel = "radial")


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  radial 
       cost:  10 

Number of Support Vectors:  13</code></pre>
</div>
</div>
<p>e avaliando,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># realizando a predicao sob o conjunto de teste</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>predicao <span class="ot">=</span> <span class="fu">predict</span>(tunefit.r<span class="sc">$</span>best.model,  <span class="fu">select</span>(teste, am, mpg, qsec))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># obtendo a matriz de confusao</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predicao, <span class="at">reference =</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  automatic manual
  automatic         5      0
  manual            0      3
                                     
               Accuracy : 1          
                 95% CI : (0.6306, 1)
    No Information Rate : 0.625      
    P-Value [Acc &gt; NIR] : 0.02328    
                                     
                  Kappa : 1          
                                     
 Mcnemar's Test P-Value : NA         
                                     
            Sensitivity : 1.000      
            Specificity : 1.000      
         Pos Pred Value : 1.000      
         Neg Pred Value : 1.000      
             Prevalence : 0.625      
         Detection Rate : 0.625      
   Detection Prevalence : 0.625      
      Balanced Accuracy : 1.000      
                                     
       'Positive' Class : automatic  
                                     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outra forma de obter a precisao</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(predicao <span class="sc">==</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
</section>
<section id="svm-com-a-função-ksvm-do-pacote-kernlab" class="level3" data-number="11.1.4">
<h3 data-number="11.1.4" class="anchored" data-anchor-id="svm-com-a-função-ksvm-do-pacote-kernlab"><span class="header-section-number">11.1.4</span> SVM com a função ksvm() do pacote kernlab</h3>
<p>Novamente, vamos trabalhar com a base mtcars.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>am <span class="ot">=</span> <span class="fu">factor</span>(mtcars<span class="sc">$</span>am, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"automatic"</span>,<span class="st">"manual"</span>))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">95</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>noTreino <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(<span class="at">y =</span> mtcars<span class="sc">$</span>am, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> F)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>treino <span class="ot">=</span> mtcars[noTreino,]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> mtcars[<span class="sc">-</span>noTreino,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="utilizando-kernel-linear-1" class="level4" data-number="11.1.4.1">
<h4 data-number="11.1.4.1" class="anchored" data-anchor-id="utilizando-kernel-linear-1"><span class="header-section-number">11.1.4.1</span> Utilizando Kernel linear</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> treino, <span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y =</span> wt, <span class="at">color =</span> am)) <span class="sc">+</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"darkolivegreen3"</span>, <span class="st">"brown2"</span>)) <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Também podemos criar modelos de SVM utilizando a função ksvm presente no pacote</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kernlab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Anexando pacote: 'kernlab'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>O seguinte objeto é mascarado por 'package:ggplot2':

    alpha</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>kernfit.l <span class="ot">=</span> <span class="fu">ksvm</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(mtcars, am, wt, hp), </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">"C-svc"</span>, <span class="at">kernel =</span> <span class="st">'vanilladot'</span>, <span class="at">C=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Setting default kernel parameters  </code></pre>
</div>
</div>
<p>Os principais argumentos dessa função são:</p>
<ul>
<li>type = Precisa ser informado. Indica qual é o tipo de preditor que queremos criar. Para classificadores, podemos usar ‘C-svc’. Para regressores, podemos usar ‘eps-svr’. Para outros types, veja a documentação da função no Help do RStudio ou neste link.</li>
<li>kernel = Indica o tipo de kernel. Vamos explorar o ‘vanilladot’ para linear, ‘polydot’ para polinomial e ‘rbfdot’ para radial (default), mas existem outros.</li>
<li>C = Quantifica a penalidade associada a uma predição incorreta. Default=1.</li>
<li>scaled = Se TRUE (default), padroniza as variáveis.</li>
<li>kpar = Lista os parâmetros necessários para o kernel utilizado. Seu default é automatico, ou seja, ele encontra o(s) parâmetros que melhor ajustam o modelo automaticamente. Mas podemos alterar se quisermos.
<ul>
<li>kernel linear -&gt; não possui parâmetros</li>
<li>kernel polinomial -&gt; Utiliza os parâmetros degree, scale e offset.</li>
<li>kernel radial -&gt; Utiliza o parâmetro sigma.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>kernfit.l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Support Vector Machine object of class "ksvm" 

SV type: C-svc  (classification) 
 parameter : cost C = 1 

Linear (vanilla) kernel function. 

Number of Support Vectors : 14 

Objective Function Value : -8.9358 
Training error : 0.0625 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtendo a precisão dentro da amostra</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> kernfit.l<span class="sc">@</span>error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9375</code></pre>
</div>
</div>
<p>E podemos avaliar, obtendo a precisão fora da amostra</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># realizando a predicao sob o conjunto de teste</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>predicao <span class="ot">=</span> kernfit.l <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="fu">select</span>(teste, am, wt, hp))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># obtendo a matriz de confusao</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predicao, <span class="at">reference =</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  automatic manual
  automatic         4      0
  manual            1      3
                                          
               Accuracy : 0.875           
                 95% CI : (0.4735, 0.9968)
    No Information Rate : 0.625           
    P-Value [Acc &gt; NIR] : 0.135           
                                          
                  Kappa : 0.75            
                                          
 Mcnemar's Test P-Value : 1.000           
                                          
            Sensitivity : 0.800           
            Specificity : 1.000           
         Pos Pred Value : 1.000           
         Neg Pred Value : 0.750           
             Prevalence : 0.625           
         Detection Rate : 0.500           
   Detection Prevalence : 0.500           
      Balanced Accuracy : 0.900           
                                          
       'Positive' Class : automatic       
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outra forma de obter a precisao</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(predicao <span class="sc">==</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.875</code></pre>
</div>
</div>
</section>
<section id="utilizando-kernel-polinomial-1" class="level4" data-number="11.1.4.2">
<h4 data-number="11.1.4.2" class="anchored" data-anchor-id="utilizando-kernel-polinomial-1"><span class="header-section-number">11.1.4.2</span> Utilizando Kernel polinomial</h4>
<p>Para treinar um modelo svm com kernel polinomial, usamos o argumento ‘kernel=’polydot’’ e passamos a lista de parametros necessários (degree, offset e scale).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">284</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>kernfit.p <span class="ot">=</span> <span class="fu">ksvm</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, wt), </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">"C-svc"</span>, <span class="at">kernel =</span> <span class="st">'polydot'</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">C=</span><span class="dv">1</span>, <span class="at">kpar=</span><span class="fu">list</span>(<span class="at">degree=</span><span class="dv">3</span>, <span class="at">offset=</span><span class="fl">0.1</span>))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>kernfit.p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Support Vector Machine object of class "ksvm" 

SV type: C-svc  (classification) 
 parameter : cost C = 1 

Polynomial kernel function. 
 Hyperparameters : degree =  3  scale =  1  offset =  0.1 

Number of Support Vectors : 9 

Objective Function Value : -5.3132 
Training error : 0.083333 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kernfit.p, <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, wt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>a avaliação é feita da mesma forma que as anteriores: As observações marcadas com um triângulo são as rotuladas com câmbio automático, enquanto as marcadas com círculo são as de câmbio manual. As formas preenchidas são as que foram usadas como vetor de suporte. Finalmente, a região azulada é onde as novas observações presentes ali serão classificadas com câmbio manual, enquanto na região avermelhada, serão classificadas automático</p>
</section>
<section id="utilizando-kernel-radial-1" class="level4" data-number="11.1.4.3">
<h4 data-number="11.1.4.3" class="anchored" data-anchor-id="utilizando-kernel-radial-1"><span class="header-section-number">11.1.4.3</span> Utilizando Kernel radial</h4>
<p>No caso radial, usamos ‘kernel=’rdfdot’’ e passamos o valor sigma.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">614</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>kernfit.r <span class="ot">=</span> <span class="fu">ksvm</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, mpg), </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">"C-svc"</span>, <span class="at">kernel =</span> <span class="st">'rbfdot'</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">C=</span><span class="dv">10</span>, <span class="at">kpar=</span><span class="fu">list</span>(<span class="at">sigma=</span><span class="fl">0.5</span>))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>kernfit.r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Support Vector Machine object of class "ksvm" 

SV type: C-svc  (classification) 
 parameter : cost C = 10 

Gaussian Radial Basis kernel function. 
 Hyperparameter : sigma =  0.5 

Number of Support Vectors : 11 

Objective Function Value : -34.0858 
Training error : 0 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kernfit.r, <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, mpg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="svm-com-a-função-train-do-pacote-caret" class="level3" data-number="11.1.5">
<h3 data-number="11.1.5" class="anchored" data-anchor-id="svm-com-a-função-train-do-pacote-caret"><span class="header-section-number">11.1.5</span> SVM com a função train() do pacote caret</h3>
<p>Ainda usando a base mtcars, vamos ver como utilizar a função train do caret para treinar um modelo de SVM. Os principais argumentos dessa função são:</p>
<ul>
<li>method = Para SVM com kernel linear, ele recebe ‘svmLinear’. Para polinomial, ‘svmPoly’. E para radial, ‘svmRadial’.</li>
<li>tuneGrid ou tuneLength = usando para testar alguns valores dos parâmetros usados. (Vamos entender melhor usando)</li>
</ul>
<section id="utilizando-kernel-linear-2" class="level4" data-number="11.1.5.1">
<h4 data-number="11.1.5.1" class="anchored" data-anchor-id="utilizando-kernel-linear-2"><span class="header-section-number">11.1.5.1</span> Utilizando Kernel linear</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret); <span class="fu">library</span>(dplyr)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># treinando o modelo</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>modelfit.l <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">train</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, wt, qsec),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method=</span><span class="st">"svmLinear"</span>, <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>),</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">C =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">15</span>) ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample01: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample02: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample03: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample04: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample05: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample06: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample07: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample08: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample09: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample10: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample11: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample12: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample13: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample14: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample15: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample16: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample17: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample18: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample19: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample20: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample21: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample22: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample23: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample24: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: model fit failed for Resample25: C=0.0000 Error in .local(x, ...) : 
  No Support Vectors found. You may want to change your parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo,
: There were missing values in resampled performance measures.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in train.default(x, y, weights = w, ...): missing values found in
aggregated results</code></pre>
</div>
</div>
<p>O kernel linear não possui parâmetros, portanto só precisamos passar o custo aqui representado por C. Usando tuneGrid = expand.grid() podemos passar um ou mais valores para cada parâmetro da função e para o C e ele testa todos eles e decide qual é o melhor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>modelfit.l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Support Vector Machines with Linear Kernel 

24 samples
 2 predictor
 2 classes: 'automatic', 'manual' 

Pre-processing: centered (2), scaled (2) 
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 24, 24, 24, 24, 24, 24, ... 
Resampling results across tuning parameters:

  C          Accuracy   Kappa    
  0.0000000        NaN        NaN
  0.1428571  0.8339278  0.6074720
  0.2857143  0.8844228  0.6865752
  0.4285714  0.8735036  0.6672053
  0.5714286  0.8829481  0.6874628
  0.7142857  0.8869481  0.6955080
  0.8571429  0.8847258  0.6923804
  1.0000000  0.8883622  0.6996517
  1.1428571  0.8883622  0.6996517
  1.2857143  0.8883622  0.6996517
  1.4285714  0.9053622  0.7343507
  1.5714286  0.9053622  0.7343507
  1.7142857  0.9093622  0.7414732
  1.8571429  0.9093622  0.7669594
  2.0000000  0.9128066  0.7704828

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was C = 2.</code></pre>
</div>
</div>
<p>Aqui, ele testou 15 valores para C e concluiu que a melhor precisão ocorria quando C = 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(modelfit.l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Aqui podemos observar a distribuição da precisão para cada valor de custo que testamos.</p>
</section>
<section id="utilizando-kernel-polinomial-2" class="level4" data-number="11.1.5.2">
<h4 data-number="11.1.5.2" class="anchored" data-anchor-id="utilizando-kernel-polinomial-2"><span class="header-section-number">11.1.5.2</span> Utilizando Kernel polinomial</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">882</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>modelfit.p <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">train</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, wt),</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method=</span><span class="st">"svmPoly"</span>, <span class="at">tuneLength =</span> <span class="dv">4</span>,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para o kernel polinomial, os parâmetros são degree e scale além do C. Usando o tuneLength, podemos passar uma quantidade n e ele testará todas as combinação com os n primeiros valores default de cada parâmetro.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>modelfit.p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Support Vector Machines with Polynomial Kernel 

24 samples
 2 predictor
 2 classes: 'automatic', 'manual' 

Pre-processing: centered (2), scaled (2) 
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 24, 24, 24, 24, 24, 24, ... 
Resampling results across tuning parameters:

  degree  scale  C     Accuracy   Kappa    
  1       0.001  0.25  0.5161659  0.1189539
  1       0.001  0.50  0.5161659  0.1189539
  1       0.001  1.00  0.5161659  0.1189539
  1       0.001  2.00  0.5161659  0.1189539
  1       0.010  0.25  0.5161659  0.1189539
  1       0.010  0.50  0.5161659  0.1189539
  1       0.010  1.00  0.5161659  0.1189539
  1       0.010  2.00  0.5161659  0.1189539
  1       0.100  0.25  0.5436912  0.1793538
  1       0.100  0.50  0.6534387  0.3891840
  1       0.100  1.00  0.8405094  0.7183571
  1       0.100  2.00  0.8765743  0.7878575
  1       1.000  0.25  0.8998470  0.8091447
  1       1.000  0.50  0.9273925  0.8454360
  1       1.000  1.00  0.9507431  0.8910997
  1       1.000  2.00  0.9551876  0.9020088
  2       0.001  0.25  0.5161659  0.1189539
  2       0.001  0.50  0.5161659  0.1189539
  2       0.001  1.00  0.5161659  0.1189539
  2       0.001  2.00  0.5161659  0.1189539
  2       0.010  0.25  0.5161659  0.1189539
  2       0.010  0.50  0.5161659  0.1189539
  2       0.010  1.00  0.5161659  0.1189539
  2       0.010  2.00  0.6264704  0.3271633
  2       0.100  0.25  0.6846782  0.4521554
  2       0.100  0.50  0.8412237  0.7195571
  2       0.100  1.00  0.8765743  0.7828179
  2       0.100  2.00  0.9237561  0.8417467
  2       1.000  0.25  0.9058167  0.7886891
  2       1.000  0.50  0.9198817  0.8181146
  2       1.000  1.00  0.9227258  0.8284860
  2       1.000  2.00  0.9227258  0.8255929
  3       0.001  0.25  0.5161659  0.1189539
  3       0.001  0.50  0.5161659  0.1189539
  3       0.001  1.00  0.5161659  0.1189539
  3       0.001  2.00  0.5161659  0.1189539
  3       0.010  0.25  0.5161659  0.1189539
  3       0.010  0.50  0.5161659  0.1189539
  3       0.010  1.00  0.5586912  0.2125406
  3       0.010  2.00  0.7107734  0.4831787
  3       0.100  0.25  0.8275570  0.6946523
  3       0.100  0.50  0.8592237  0.7463197
  3       0.100  1.00  0.8954055  0.8078916
  3       0.100  2.00  0.9294704  0.8464987
  3       1.000  0.25  0.8975195  0.7884825
  3       1.000  0.50  0.9196003  0.8289326
  3       1.000  1.00  0.9236003  0.8343143
  3       1.000  2.00  0.9336003  0.8529297

Accuracy was used to select the optimal model using the largest value.
The final values used for the model were degree = 1, scale = 1 and C = 2.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>modelfit.p<span class="sc">$</span>bestTune</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   degree scale C
16      1     1 2</code></pre>
</div>
</div>
<p>e então ele utiliza a combinação que possui a melhor precisão.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(modelfit.p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>O plot nos mostra a distribuição da precisão em cada combinação de custo, degree e scale. Por exemplo, podemos ver que usando <span class="math inline">\(degree = 1\)</span> (Primeiro quadro), <span class="math inline">\(scale = 0.1\)</span> (eixo x/abscissa) e <span class="math inline">\(C = 2\)</span> (linha vermelha) alcançamos uma precisão em torno de <span class="math inline">\(0.88\)</span> (eixo y/ordenadas).</p>
<p>Avaliando o modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>predicao <span class="ot">=</span> modelfit.p <span class="sc">%&gt;%</span> <span class="fu">predict</span>( <span class="fu">select</span>(teste, am, qsec, wt) )</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># obtendo a matriz de confusao</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predicao, <span class="at">reference =</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  automatic manual
  automatic         4      0
  manual            1      3
                                          
               Accuracy : 0.875           
                 95% CI : (0.4735, 0.9968)
    No Information Rate : 0.625           
    P-Value [Acc &gt; NIR] : 0.135           
                                          
                  Kappa : 0.75            
                                          
 Mcnemar's Test P-Value : 1.000           
                                          
            Sensitivity : 0.800           
            Specificity : 1.000           
         Pos Pred Value : 1.000           
         Neg Pred Value : 0.750           
             Prevalence : 0.625           
         Detection Rate : 0.500           
   Detection Prevalence : 0.500           
      Balanced Accuracy : 0.900           
                                          
       'Positive' Class : automatic       
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outra forma de obter a precisao</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(predicao <span class="sc">==</span> teste<span class="sc">$</span>am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.875</code></pre>
</div>
</div>
</section>
<section id="utilizando-kernel-radial-2" class="level4" data-number="11.1.5.3">
<h4 data-number="11.1.5.3" class="anchored" data-anchor-id="utilizando-kernel-radial-2"><span class="header-section-number">11.1.5.3</span> Utilizando Kernel radial</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">109</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>modelfit.r <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">train</span>(am <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(treino, am, qsec, mpg),</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"svmRadial"</span>, <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>),</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tuneGrid=</span><span class="fu">expand.grid</span>(<span class="at">C=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>),</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">sigma=</span><span class="fu">seq</span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>, <span class="at">length=</span><span class="dv">5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para o kernel radial, temos o parâmetro sigma.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>modelfit.r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Support Vector Machines with Radial Basis Function Kernel 

24 samples
 2 predictor
 2 classes: 'automatic', 'manual' 

Pre-processing: centered (2), scaled (2) 
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 24, 24, 24, 24, 24, 24, ... 
Resampling results across tuning parameters:

  C     sigma  Accuracy   Kappa    
   0.5  0.50   0.7916118  0.5710319
   0.5  0.75   0.7870693  0.5735315
   0.5  1.00   0.7660996  0.5332282
   0.5  1.25   0.7629076  0.5247248
   0.5  1.50   0.7433045  0.4873416
   1.0  0.50   0.7769913  0.5500594
   1.0  0.75   0.7529105  0.5013235
   1.0  1.00   0.7524488  0.5055922
   1.0  1.25   0.7430981  0.4930791
   1.0  1.50   0.7380981  0.4816286
   5.0  0.50   0.7794156  0.5438133
   5.0  0.75   0.7563377  0.5038143
   5.0  1.00   0.7420346  0.4818703
   5.0  1.25   0.7460346  0.4960802
   5.0  1.50   0.7308759  0.4725168
  10.0  0.50   0.7890188  0.5662949
  10.0  0.75   0.7762107  0.5495060
  10.0  1.00   0.7584156  0.5178123
  10.0  1.25   0.7517489  0.5119656
  10.0  1.50   0.7251616  0.4630399

Accuracy was used to select the optimal model using the largest value.
The final values used for the model were sigma = 0.5 and C = 0.5.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(modelfit.r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="k-nearest-neighbors-knn" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="k-nearest-neighbors-knn"><span class="header-section-number">11.2</span> K-Nearest Neighbors (KNN)</h2>
<p>O método K-Nearest Neighbors (KNN) - K vizinhos mais próximos - já foi brevemente comentado neste material no capítulo de pré-processamento, com o objetivo de tratar NA’s em uma base de dados. Agora veremos como utilizá-lo para problemas de machine learning de classificação e regressão. Veremos os detalhes de como o método funciona para ambos os casos e duas formas de implementá-lo: utilizando funções do pacote FNN e a função train() do pacote caret.</p>
<section id="em-classificação-1" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="em-classificação-1"><span class="header-section-number">11.2.1</span> Em Classificação</h3>
<p>O método KNN assume que há similaridade em observações próximas do conjunto de dados. A previsão para uma nova amostra é feita pesquisando em todo o conjunto de treinamento os k vizinhos mais próximos dessa amostra, e assim computando a classe mais observada (moda) à essa observação. Ou seja, diferentemente dos outros métodos vistos até agora, o KNN é um modelo que não precisa ser treinado.</p>
<p>Outros pontos que são importantes ser citados são:</p>
<ol type="1">
<li><p>O KNN é mais adequado para dados de baixa dimensão (poucas variáveis), e</p></li>
<li><p>O KNN é considerado um algoritmo “preguiçoso” (lento).</p></li>
</ol>
<p>Vamos entender o passo a passo de como o método funciona a seguir. Considere que a amostra abaixo seja nossa amostra treino.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>treino <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"heart_treino.xlsx"</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>treino</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  RestBP  Chol AHD  
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1    145   233 No   
2    160   286 Yes  
3    130   250 No   
4    120   236 No   
5    120   354 No   
6    130   254 Yes  
7    140   203 Yes  </code></pre>
</div>
</div>
<p>Queremos predizer se uma pessoa possui uma doença cardíaca (variável “AHD”) baseado nas seguintes variáveis:</p>
<ul>
<li>RestBP: pressão arterial, medida em milímetros de mercúrio (mmHg);</li>
<li>Chol: colesterol sérico, medido em miligramas por decilitro (mg/dl).</li>
</ul>
<p>Como não precisamos treinar o modelo, vamos carregar a amostra teste para aplicá-lo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"heart_teste.xlsx"</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>teste</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  RestBP  Chol AHD  
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1    120   229 Yes  
2    130   204 No   
3    140   268 Yes  </code></pre>
</div>
</div>
<p>Como a amostra teste serve para simular uma nova amostra, precisamos utilizá-la sem os rótulos na variável a ser predita. Assim, vamos criar uma nova amostra teste não rotulada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>teste_predicao <span class="ot">=</span> teste</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Retirando os rótulos:</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>teste_predicao<span class="sc">$</span>AHD <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntando em uma mesma base para facilitar as contas e a plotagem do gráfico:</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>base <span class="ot">=</span> <span class="fu">rbind</span>(treino, teste_predicao)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Inserindo uma nova coluna com a numeração das observações:</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>base <span class="ot">=</span> tibble<span class="sc">::</span><span class="fu">add_column</span>(base, <span class="at">X1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.before =</span> <span class="st">"RestBP"</span>)</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico:</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(base, <span class="fu">aes</span>(<span class="at">x =</span> RestBP, <span class="at">y =</span> Chol, <span class="at">color =</span> AHD)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> X1), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Pressão Arterial (mmHg)"</span>) <span class="sc">+</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Colesterol Sérico (mg/dl)"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Presença de Doença Cardíaca em Pacientes"</span>) <span class="sc">+</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">name =</span> <span class="st">"Doença Cardíaca"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="cn">NA</span>),</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Não"</span>, <span class="st">"Sim"</span>, <span class="st">"Desconhecido"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>O primeiro passo é escolher um valor para o k. Como a predição será feita com base na moda das k classificações mais próximas da amostra, é recomendado escolher um k ímpar, para evitar algum possível empate. Vamos utilizar k = 3.</p>
<p>OBS: o melhor valor para k pode ser encontrado por cross validation.</p>
<p>Para verificar quais são os 3 vizinhos mais próximos das observações precisamos calcular as distâncias entre elas e todas as observações do conjunto de dados e pegar as 3 menores. Existem vários métodos de se calcular a distância entre dois pontos, mas a mais usual é a distância euclidiana.</p>
<section id="distância-euclidiana" class="level4" data-number="11.2.1.1">
<h4 data-number="11.2.1.1" class="anchored" data-anchor-id="distância-euclidiana"><span class="header-section-number">11.2.1.1</span> Distância Euclidiana:</h4>
<p>Sejam <span class="math inline">\(p = (p_1, p_2, ..., p_n)\)</span> e <span class="math inline">\(q = (q_1, q_2, ..., q_n)\)</span> dois pontos de dimensão n.&nbsp;A distância euclidiana entre p e q é definida como: <span class="math inline">\(d(p, q) = \sqrt{\sum_{i=1}^n(p_i - q_i)^2}\)</span>.</p>
<p>Vamos, primeiramente, calcular a distância euclidiana entra a observação 8 (a primeira do conjunto teste) e todas as demais observações.</p>
<ul>
<li><p>Distância entre as observações 8 e 1: <span class="math inline">\(\sqrt{(120 - 145)^2 + (229-233)^2} = 25.318\)</span>;</p></li>
<li><p>Distância entre as observações 8 e 2: <span class="math inline">\(\sqrt{(120 - 160)^2 + (229-286)^2} = 69.635\)</span>;</p></li>
<li><p>Distância entre as observações 8 e 3: <span class="math inline">\(\sqrt{(120 - 130)^2 + (229-250)^2} = 23.259\)</span>;</p></li>
<li><p>Distância entre as observações 8 e 4: <span class="math inline">\(\sqrt{(120 - 120)^2 + (229-236)^2} = 7.000\)</span>;</p></li>
<li><p>Distância entre as observações 8 e 5: <span class="math inline">\(\sqrt{(120 - 120)^2 + (229-354)^2} = 125.000\)</span>;</p></li>
<li><p>Distância entre as observações 8 e 6: <span class="math inline">\(\sqrt{(120 - 130)^2 + (229-254)^2} = 26.926\)</span>;</p></li>
<li><p>Distância entre as observações 8 e 7: <span class="math inline">\(\sqrt{(120 - 140)^2 + (229-203)^2} = 32.802\)</span>;</p></li>
</ul>
<p>Podemos ver que as observações mais próximas da observação 8 são as observações 4, 3 e 1, respectivamente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(base, <span class="fu">aes</span>(<span class="at">x =</span> RestBP, <span class="at">y =</span> Chol, <span class="at">color =</span> AHD)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> X1), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pressão Arterial (mmHg)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Colesterol Sérico (mg/dl)"</span>) <span class="sc">+</span> </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Presença de Doença Cardíaca em Pacientes"</span>) <span class="sc">+</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">120</span>, <span class="at">xend =</span> <span class="dv">120</span>, <span class="at">y =</span> <span class="dv">229</span>, <span class="at">yend =</span> <span class="dv">236</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">120</span>, <span class="at">xend =</span> <span class="dv">130</span>, <span class="at">y =</span> <span class="dv">229</span>, <span class="at">yend =</span> <span class="dv">250</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">120</span>, <span class="at">xend =</span> <span class="dv">145</span>, <span class="at">y =</span> <span class="dv">229</span>, <span class="at">yend =</span> <span class="dv">233</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">name =</span> <span class="st">"Doença Cardíaca"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="cn">NA</span>),</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Não"</span>, <span class="st">"Sim"</span>, <span class="st">"Desconhecido"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 120, xend = 120, y = 229, yend = 236), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 120, xend = 130, y = 229, yend = 250), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 120, xend = 145, y = 229, yend = 233), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Logo, como as 3 observações são classificadas como “Não” para a variável de interesse, imputamos essa classificação à observação que queremos prever.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertendo a coluna com as predições para character para poder acrescentar a predição:</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>teste_predicao<span class="sc">$</span>AHD <span class="ot">=</span> <span class="fu">as.character</span>(teste_predicao<span class="sc">$</span>AHD)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A observação 8 na "base" é a observação 1 no "teste_predicao".</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>teste_predicao[<span class="dv">1</span>,<span class="dv">3</span>] <span class="ot">=</span> <span class="st">"No"</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>teste_predicao</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  RestBP  Chol AHD  
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1    120   229 No   
2    130   204 &lt;NA&gt; 
3    140   268 &lt;NA&gt; </code></pre>
</div>
</div>
<p>Agora vamos realizar o mesmo procedimento para a observação 9:</p>
<ul>
<li><p>Distância entre as observações 9 e 1: <span class="math inline">\(\sqrt{(130 - 145)^2 + (204-233)^2} = 32.650\)</span>;</p></li>
<li><p>Distância entre as observações 9 e 2: <span class="math inline">\(\sqrt{(130 - 160)^2 + (204-286)^2} = 87.316\)</span>;</p></li>
<li><p>Distância entre as observações 9 e 3: <span class="math inline">\(\sqrt{(130 - 130)^2 + (204-250)^2} = 46.000\)</span>;</p></li>
<li><p>Distância entre as observações 9 e 4: <span class="math inline">\(\sqrt{(130 - 120)^2 + (204-236)^2} = 33.526\)</span>;</p></li>
<li><p>Distância entre as observações 9 e 5: <span class="math inline">\(\sqrt{(130 - 120)^2 + (204-354)^2} = 150.333\)</span>;</p></li>
<li><p>Distância entre as observações 9 e 6: <span class="math inline">\(\sqrt{(130 - 130)^2 + (204-254)^2} = 50.000\)</span>;</p></li>
<li><p>Distância entre as observações 9 e 7: <span class="math inline">\(\sqrt{(130 - 140)^2 + (204-203)^2} = 10.050\)</span>;</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(base, <span class="fu">aes</span>(<span class="at">x =</span> RestBP, <span class="at">y =</span> Chol, <span class="at">color =</span> AHD)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> X1), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pressão Arterial (mmHg)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Colesterol Sérico (mg/dl)"</span>) <span class="sc">+</span> </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Presença de Doença Cardíaca em Pacientes"</span>) <span class="sc">+</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">130</span>, <span class="at">xend =</span> <span class="dv">140</span>, <span class="at">y =</span> <span class="dv">204</span>, <span class="at">yend =</span> <span class="dv">203</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">130</span>, <span class="at">xend =</span> <span class="dv">145</span>, <span class="at">y =</span> <span class="dv">204</span>, <span class="at">yend =</span> <span class="dv">233</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">130</span>, <span class="at">xend =</span> <span class="dv">120</span>, <span class="at">y =</span> <span class="dv">204</span>, <span class="at">yend =</span> <span class="dv">236</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">name =</span> <span class="st">"Doença Cardíaca"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="cn">NA</span>),</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Não"</span>, <span class="st">"Sim"</span>, <span class="st">"Desconhecido"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 130, xend = 140, y = 204, yend = 203), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 130, xend = 145, y = 204, yend = 233), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 130, xend = 120, y = 204, yend = 236), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Como 2 das 3 observações são classificadas como “Não”, a observação 9 recebe a classificação “Não”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A observação 9 na "base" é a observação 2 no "teste_predicao".</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>teste_predicao[<span class="dv">2</span>,<span class="dv">3</span>] <span class="ot">=</span> <span class="st">"No"</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>teste_predicao</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  RestBP  Chol AHD  
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1    120   229 No   
2    130   204 No   
3    140   268 &lt;NA&gt; </code></pre>
</div>
</div>
<p>Por último, vamos classificar a observação 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(base, <span class="fu">aes</span>(<span class="at">x =</span> RestBP, <span class="at">y =</span> Chol, <span class="at">color =</span> AHD)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> X1), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pressão Arterial (mmHg)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Colesterol Sérico (mg/dl)"</span>) <span class="sc">+</span> </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Presença de Doença Cardíaca em Pacientes"</span>) <span class="sc">+</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">140</span>, <span class="at">xend =</span> <span class="dv">130</span>, <span class="at">y =</span> <span class="dv">268</span>, <span class="at">yend =</span> <span class="dv">254</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">140</span>, <span class="at">xend =</span> <span class="dv">130</span>, <span class="at">y =</span> <span class="dv">268</span>, <span class="at">yend =</span> <span class="dv">250</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">140</span>, <span class="at">xend =</span> <span class="dv">160</span>, <span class="at">y =</span> <span class="dv">268</span>, <span class="at">yend =</span> <span class="dv">286</span>), <span class="at">size =</span> .<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">name =</span> <span class="st">"Doença Cardíaca"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="cn">NA</span>),</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Não"</span>, <span class="st">"Sim"</span>, <span class="st">"Desconhecido"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 140, xend = 130, y = 268, yend = 254), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 140, xend = 130, y = 268, yend = 250), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 140, xend = 160, y = 268, yend = 286), size = 0.8, : All aesthetics have length 1, but the data has 10 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Então a observação recebe a classificação “Sim”, visto que 2 das 3 observações mais próximas à ela são classificadas como “Sim”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A observação 10 na "base" é a observação 3 no "teste_predicao".</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>teste_predicao[<span class="dv">3</span>,<span class="dv">3</span>] <span class="ot">=</span> <span class="st">"Yes"</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>teste_predicao</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  RestBP  Chol AHD  
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1    120   229 No   
2    130   204 No   
3    140   268 Yes  </code></pre>
</div>
</div>
<p>E assim terminamos as nossas predições. Vamos construir a matriz de confusão para ver o quanto acertamos:</p>
<p>table(teste_predicao<span class="math inline">\(AHD, teste\)</span>AHD)</p>
<p>O algoritmo acertou 2 das 3 classificações da amostra teste, o que nos dá uma precisão de 66,67%, uma sensibilidade de 50% e uma especificidade de 100%. Como identificar os pacientes que possuem uma doença cardíaca é mais importante do que identificar os que não possuem, devemos dar mais peso à sensibilidade do nosso modelo do que à especificidade. Ou seja, o modelo não se saiu tão bem quanto o esperado, mas isso se deve principalmente ao fato de termos utilizado uma amostra muito pequena. Se obtivéssemos essas medidas num problema real (com bases grandes), esse modelo não seria o mais adequado. Outro fator que deve ser levado em conta também é a escolha do valor de k, que não deve ser feita de forma aleatória e sim de forma a otimizar o modelo.</p>
</section>
</section>
<section id="em-regressão-1" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="em-regressão-1"><span class="header-section-number">11.2.2</span> Em Regressão</h3>
<p>Para esse exemplo, vamos utilizar a base de dados faithful do pacote básico do R. Queremos prever o tempo de espera (waiting) entre uma erupção e outra de um geiser dado o tempo de erupção (<em>eruption</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"faithful"</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>noTreino <span class="ot">=</span> <span class="fu">createDataPartition</span>(faithful<span class="sc">$</span>waiting, <span class="at">p=</span><span class="fl">0.7</span>, <span class="at">list=</span>F)</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>treino <span class="ot">=</span> faithful[noTreino,]</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> faithful[<span class="sc">-</span>noTreino,]</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(treino, <span class="fu">aes</span>(<span class="at">x=</span>eruptions, <span class="at">y=</span>waiting)) <span class="sc">+</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Suponha que obtivemos uma nova observação cujo tempo de erupção foi de <span class="math inline">\(3.2\)</span>, indicado pela linha vermelha.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(treino, <span class="fu">aes</span>(<span class="at">x=</span>eruptions, <span class="at">y=</span>waiting)) <span class="sc">+</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span> <span class="fl">3.2</span>, <span class="at">colour=</span><span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Assim como em classificação, a ideia do KNN é estimar o valor pela média das sobservações menos distantes. Essa distância pode ser obtida pela método Euclidiano, de Manhattan ou ainda outro. O mais comum é o Euclidiano <span class="math inline">\(d(p, q) = \sqrt{\sum_{i=1}^n(p_i - q_i)^2}\)</span> que é o que usaremos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando a distancia euclidiana</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>treino<span class="ot">=</span> <span class="fu">mutate</span>(treino, </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">distancia =</span> <span class="fu">sqrt</span>( (eruptions <span class="sc">-</span> <span class="fl">3.2</span>)<span class="sc">^</span><span class="dv">2</span> ) )</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mostrando a primeira observação da base ordenada pela distancia </span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">arrange</span>(treino, distancia), <span class="at">n=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  eruptions waiting distancia
1     3.317      83     0.117</code></pre>
</div>
</div>
<p>O vizinho mais próximo de <span class="math inline">\(3.2\)</span> é <span class="math inline">\(3.317\)</span>. Então, usando um k=1, temos que o tempo estimado de espera (waiting) para essa nova observação é a média dos valores vizinhos. Nesse caso, <span class="math inline">\(83\)</span> indicado pelo ponto vermelho.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">media =</span> <span class="fu">mean</span>(<span class="fu">head</span>(<span class="fu">arrange</span>(treino, distancia), <span class="at">n=</span><span class="dv">1</span>)<span class="sc">$</span>waiting))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 83</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k = 1</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(treino, <span class="fu">aes</span>(<span class="at">x=</span>eruptions, <span class="at">y=</span>waiting)) <span class="sc">+</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> (<span class="fl">3.2</span> <span class="sc">-</span> <span class="fl">0.12</span>), <span class="at">xmax =</span> (<span class="fl">3.2</span> <span class="sc">+</span> <span class="fl">0.12</span>),</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="dv">40</span>, <span class="at">ymax =</span> <span class="dv">100</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"pointrange"</span>, <span class="at">x =</span> <span class="fl">3.2</span>, <span class="at">y =</span> media, </span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="dv">40</span>, <span class="at">ymax =</span> <span class="dv">100</span>, <span class="at">colour =</span> <span class="st">"red"</span>, </span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Poderiamos usar um k=10, nesse caso, teriamos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">arrange</span>(treino, distancia), <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   eruptions waiting distancia
1      3.317      83     0.117
2      3.067      69     0.133
3      3.367      66     0.167
4      3.417      64     0.217
5      3.450      78     0.250
6      3.500      66     0.300
7      2.900      63     0.300
8      2.883      55     0.317
9      3.567      73     0.367
10     3.600      79     0.400</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">media =</span> <span class="fu">mean</span>(<span class="fu">head</span>(<span class="fu">arrange</span>(treino, distancia), <span class="at">n=</span><span class="dv">10</span>)<span class="sc">$</span>waiting))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 69.6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k = 10</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(treino, <span class="fu">aes</span>(<span class="at">x=</span>eruptions, <span class="at">y=</span>waiting)) <span class="sc">+</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> (<span class="fl">3.2</span> <span class="sc">-</span> <span class="fl">0.45</span>), <span class="at">xmax =</span> (<span class="fl">3.2</span> <span class="sc">+</span> <span class="fl">0.45</span>), </span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin=</span> <span class="dv">40</span>, <span class="at">ymax=</span><span class="dv">100</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"pointrange"</span>, <span class="at">x =</span> <span class="fl">3.2</span>, <span class="at">y =</span> media, </span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="dv">40</span>, <span class="at">ymax =</span> <span class="dv">100</span>, <span class="at">colour =</span> <span class="st">"red"</span>, </span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ou ainda, um k=190</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mostrando as ultimas observações ordenadas pela distancia</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">arrange</span>(treino, distancia), <span class="at">n=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    eruptions waiting distancia
188     4.933      86     1.733
189     4.933      86     1.733
190     5.033      77     1.833
191     5.067      76     1.867
192     5.100      96     1.900</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">media =</span> <span class="fu">mean</span>(<span class="fu">head</span>(<span class="fu">arrange</span>(treino, distancia), <span class="at">n=</span><span class="dv">190</span>)<span class="sc">$</span>waiting))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70.81053</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k = 190</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(treino, <span class="fu">aes</span>(<span class="at">x=</span>eruptions, <span class="at">y=</span>waiting)) <span class="sc">+</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin=</span> (<span class="fl">3.2</span> <span class="sc">-</span><span class="fl">1.85</span>), <span class="at">xmax=</span>(<span class="fl">3.2</span> <span class="sc">+</span><span class="fl">1.85</span>), </span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin=</span> <span class="dv">40</span>, <span class="at">ymax=</span><span class="dv">100</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"pointrange"</span>, <span class="at">x =</span> <span class="fl">3.2</span>, <span class="at">y =</span> media, </span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="dv">40</span>, <span class="at">ymax =</span> <span class="dv">100</span>, <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Para bases com mais de uma variável explicativa, o cálculo da distância é feito da mesma forma assim como foi mostrado na parte de classificação.</p>
</section>
<section id="knn-com-o-pacote-fnn" class="level3" data-number="11.2.3">
<h3 data-number="11.2.3" class="anchored" data-anchor-id="knn-com-o-pacote-fnn"><span class="header-section-number">11.2.3</span> KNN com o pacote FNN</h3>
<p>Agora veremos como utilizar algumas funções do pacote FNN (<em>Fast Nearest Neighbor</em>) para aplicarmos o KNN em um problema de classificação e de regressão. Iremos utilizar bases de dados reais obtidas no repositório de aprendizado de máquina https://archive.ics.uci.edu/ml/index.php.</p>
<section id="em-classificação-2" class="level4" data-number="11.2.3.1">
<h4 data-number="11.2.3.1" class="anchored" data-anchor-id="em-classificação-2"><span class="header-section-number">11.2.3.1</span> Em Classificação</h4>
<p>Vamos carregar a base de dados transfusion. Essa base contém algumas informações sobre doação de sangue de 748 voluntários. Nossa variável de interesse é a variável “whether.he.she.donated.blood.in.March.2007”, que indica se o paciente doou sangue em março de 2007 ou não (1 - doou, 0 - não doou). As variáveis explicativas são as seguintes:</p>
<ul>
<li>Recency..months. - meses desde a última doação de sangue;</li>
<li>Frequency..times. - número total de doações já realizadas;</li>
<li>Monetary..c.c..blood. - sangue total já doado em c.c. (centímetros cúbicos);</li>
<li>Time..months - meses desde a 1ª doação de sangue.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>base <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"transfusion.rds"</span>)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   748 obs. of  5 variables:
 $ Recency..months.                          : num  2 0 1 2 1 4 2 1 2 5 ...
 $ Frequency..times.                         : int  50 13 16 20 24 4 7 12 9 46 ...
 $ Monetary..c.c..blood.                     : int  12500 3250 4000 5000 6000 1000 1750 3000 2250 11500 ...
 $ Time..months.                             : num  98 28 35 45 77 4 14 35 22 98 ...
 $ whether.he.she.donated.blood.in.March.2007: int  1 1 1 1 0 0 1 0 1 1 ...</code></pre>
</div>
</div>
<p>É importante ressaltar que para aplicação do KNN todas as variáveis explicativas devem ser numéricas. Como isso ocorre na nossa base, vamos prosseguir para a divisão em treino e teste.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando 80% dos dados para o treino:</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>noTreino <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(<span class="at">y =</span> base<span class="sc">$</span>whether.he.she.donated.blood.in.March<span class="fl">.2007</span>,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">p =</span> .<span class="dv">8</span>, <span class="at">list =</span> F)</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>treino <span class="ot">=</span> base[noTreino,]</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> base[<span class="sc">-</span>noTreino,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como temos que escolher o melhor valor de k para o modelo, não podemos escolhê-lo de forma arbitrária. Sendo assim, vamos pegar uma parte do nosso conjunto de treino e utilizarmos para validação. A validação, como já comentado no capítulo Design de Predição, serve como um “pré-teste”, onde iremos utilizar vários valores diferentes de k nela, e selecionar aquele que otimiza a predição. Esse será o valor utilizado para a amostra teste.</p>
<p>Vamos pegar 20% dos dados para a validação. Dessa forma, temos que pegar 25% da amostra treino, pois ela é 80% dos dados totais (<span class="math inline">\(0.25 \times 0.8 = 0.2\)</span>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>treino_indices <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(<span class="at">y =</span> treino<span class="sc">$</span>whether.he.she.donated.blood.in.March<span class="fl">.2007</span>,</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">p =</span> .<span class="dv">75</span>, <span class="at">list =</span> F)</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>Treino <span class="ot">=</span> treino[treino_indices,]</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>validacao <span class="ot">=</span> treino[<span class="sc">-</span>treino_indices,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Além disso, temos que separar a variável de interesse das variáveis explicativas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando o rótulo do conjunto treino:</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>Treino_label <span class="ot">=</span> Treino<span class="sc">$</span>whether.he.she.donated.blood.in.March<span class="fl">.2007</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando apenas as variáveis explicativas do conjunto treino:</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>Treino <span class="ot">=</span> Treino <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>whether.he.she.donated.blood.in.March<span class="fl">.2007</span>)</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando o rótulo da validação:</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>validacao_label <span class="ot">=</span> validacao<span class="sc">$</span>whether.he.she.donated.blood.in.March<span class="fl">.2007</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando apenas as variáveis explicativas da validação:</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>validacao <span class="ot">=</span> validacao <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>whether.he.she.donated.blood.in.March<span class="fl">.2007</span>)</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando o rótulo do conjunto teste:</span></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>teste_label <span class="ot">=</span> teste<span class="sc">$</span>whether.he.she.donated.blood.in.March<span class="fl">.2007</span></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando apenas as variáveis explicativas do conjunto teste:</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> teste <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>whether.he.she.donated.blood.in.March<span class="fl">.2007</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora vamos utilizar a função knn() do pacote FNN para predizermos os valores da validação a partir dos valores ímpares de k no intervalo de 1 a 19. É importante ressaltar que essa função só pode ser utilizada para problemas de classificação. Os principais argumentos dessa função são:</p>
<ul>
<li>train - conjunto treino sem os rótulos;</li>
<li>test - conjunto de teste sem os rótulos;</li>
<li>cl - rótulos do conjunto treino;</li>
<li>k - valor de k (vizinhos) a serem utilizados.</li>
</ul>
<p>OBS: caso utilize algum valor par de k na função e houver um empate na classificação de alguma amostra, sua classificação final é decidida de forma aleatória.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lista que conterá as matrizes de confusão e medidas de avaliação para cada k utilizado:</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>matrizes <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span>{</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">=</span> FNN<span class="sc">::</span><span class="fu">knn</span>(<span class="at">train =</span> Treino, <span class="at">test =</span> validacao, <span class="at">cl =</span> Treino_label, <span class="at">k =</span> i)</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>  matrizes[[i]] <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(modelo, <span class="fu">as.factor</span>(validacao_label), <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">21</span>) <span class="cf">break</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in confusionMatrix.default(modelo, as.factor(validacao_label), positive
= "1"): Levels are not in the same order for reference and data. Refactoring
data to match.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>matrizes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 92 36
         1  9 12
                                          
               Accuracy : 0.698           
                 95% CI : (0.6175, 0.7704)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.3337368       
                                          
                  Kappa : 0.1887          
                                          
 Mcnemar's Test P-Value : 0.0001063       
                                          
            Sensitivity : 0.25000         
            Specificity : 0.91089         
         Pos Pred Value : 0.57143         
         Neg Pred Value : 0.71875         
             Prevalence : 0.32215         
         Detection Rate : 0.08054         
   Detection Prevalence : 0.14094         
      Balanced Accuracy : 0.58045         
                                          
       'Positive' Class : 1               
                                          

[[2]]
NULL

[[3]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 97 37
         1  4 11
                                          
               Accuracy : 0.7248          
                 95% CI : (0.6457, 0.7947)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.1265          
                                          
                  Kappa : 0.2313          
                                          
 Mcnemar's Test P-Value : 5.806e-07       
                                          
            Sensitivity : 0.22917         
            Specificity : 0.96040         
         Pos Pred Value : 0.73333         
         Neg Pred Value : 0.72388         
             Prevalence : 0.32215         
         Detection Rate : 0.07383         
   Detection Prevalence : 0.10067         
      Balanced Accuracy : 0.59478         
                                          
       'Positive' Class : 1               
                                          

[[4]]
NULL

[[5]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 96 39
         1  5  9
                                          
               Accuracy : 0.7047          
                 95% CI : (0.6245, 0.7765)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.272           
                                          
                  Kappa : 0.1695          
                                          
 Mcnemar's Test P-Value : 6.527e-07       
                                          
            Sensitivity : 0.18750         
            Specificity : 0.95050         
         Pos Pred Value : 0.64286         
         Neg Pred Value : 0.71111         
             Prevalence : 0.32215         
         Detection Rate : 0.06040         
   Detection Prevalence : 0.09396         
      Balanced Accuracy : 0.56900         
                                          
       'Positive' Class : 1               
                                          

[[6]]
NULL

[[7]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 99 39
         1  2  9
                                          
               Accuracy : 0.7248          
                 95% CI : (0.6457, 0.7947)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.1265          
                                          
                  Kappa : 0.2102          
                                          
 Mcnemar's Test P-Value : 1.885e-08       
                                          
            Sensitivity : 0.18750         
            Specificity : 0.98020         
         Pos Pred Value : 0.81818         
         Neg Pred Value : 0.71739         
             Prevalence : 0.32215         
         Detection Rate : 0.06040         
   Detection Prevalence : 0.07383         
      Balanced Accuracy : 0.58385         
                                          
       'Positive' Class : 1               
                                          

[[8]]
NULL

[[9]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 97 41
         1  4  7
                                          
               Accuracy : 0.698           
                 95% CI : (0.6175, 0.7704)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.3337          
                                          
                  Kappa : 0.1332          
                                          
 Mcnemar's Test P-Value : 8.025e-08       
                                          
            Sensitivity : 0.14583         
            Specificity : 0.96040         
         Pos Pred Value : 0.63636         
         Neg Pred Value : 0.70290         
             Prevalence : 0.32215         
         Detection Rate : 0.04698         
   Detection Prevalence : 0.07383         
      Balanced Accuracy : 0.55311         
                                          
       'Positive' Class : 1               
                                          

[[10]]
NULL

[[11]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 97 43
         1  4  5
                                          
               Accuracy : 0.6846          
                 95% CI : (0.6035, 0.7582)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.4692          
                                          
                  Kappa : 0.0821          
                                          
 Mcnemar's Test P-Value : 2.976e-08       
                                          
            Sensitivity : 0.10417         
            Specificity : 0.96040         
         Pos Pred Value : 0.55556         
         Neg Pred Value : 0.69286         
             Prevalence : 0.32215         
         Detection Rate : 0.03356         
   Detection Prevalence : 0.06040         
      Balanced Accuracy : 0.53228         
                                          
       'Positive' Class : 1               
                                          

[[12]]
NULL

[[13]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 97 44
         1  4  4
                                         
               Accuracy : 0.6779         
                 95% CI : (0.5965, 0.752)
    No Information Rate : 0.6779         
    P-Value [Acc &gt; NIR] : 0.539          
                                         
                  Kappa : 0.056          
                                         
 Mcnemar's Test P-Value : 1.811e-08      
                                         
            Sensitivity : 0.08333        
            Specificity : 0.96040        
         Pos Pred Value : 0.50000        
         Neg Pred Value : 0.68794        
             Prevalence : 0.32215        
         Detection Rate : 0.02685        
   Detection Prevalence : 0.05369        
      Balanced Accuracy : 0.52186        
                                         
       'Positive' Class : 1              
                                         

[[14]]
NULL

[[15]]
Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 100  45
         1   1   3
                                          
               Accuracy : 0.6913          
                 95% CI : (0.6105, 0.7643)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.4001          
                                          
                  Kappa : 0.0693          
                                          
 Mcnemar's Test P-Value : 2.298e-10       
                                          
            Sensitivity : 0.06250         
            Specificity : 0.99010         
         Pos Pred Value : 0.75000         
         Neg Pred Value : 0.68966         
             Prevalence : 0.32215         
         Detection Rate : 0.02013         
   Detection Prevalence : 0.02685         
      Balanced Accuracy : 0.52630         
                                          
       'Positive' Class : 1               
                                          

[[16]]
NULL

[[17]]
Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 100  44
         1   1   4
                                          
               Accuracy : 0.698           
                 95% CI : (0.6175, 0.7704)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.3337          
                                          
                  Kappa : 0.096           
                                          
 Mcnemar's Test P-Value : 3.825e-10       
                                          
            Sensitivity : 0.08333         
            Specificity : 0.99010         
         Pos Pred Value : 0.80000         
         Neg Pred Value : 0.69444         
             Prevalence : 0.32215         
         Detection Rate : 0.02685         
   Detection Prevalence : 0.03356         
      Balanced Accuracy : 0.53672         
                                          
       'Positive' Class : 1               
                                          

[[18]]
NULL

[[19]]
Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 101  48
         1   0   0
                                         
               Accuracy : 0.6779         
                 95% CI : (0.5965, 0.752)
    No Information Rate : 0.6779         
    P-Value [Acc &gt; NIR] : 0.539          
                                         
                  Kappa : 0              
                                         
 Mcnemar's Test P-Value : 1.17e-11       
                                         
            Sensitivity : 0.0000         
            Specificity : 1.0000         
         Pos Pred Value :    NaN         
         Neg Pred Value : 0.6779         
             Prevalence : 0.3221         
         Detection Rate : 0.0000         
   Detection Prevalence : 0.0000         
      Balanced Accuracy : 0.5000         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<p>Note que os modelos que possuem as maiores precisões são os com k = 3 e k = 7, de 0,7248. Porém, como no nosso problema identificar quem doou sangue é mais importante do que identificar aqueles que não doaram, vamos escolher o com maior sensibilidade. Sendo assim, o melhor k é o k = 1, que obteve uma sensibilidade de 0,25.</p>
<p>O KNN com k = 1 é conhecido como The Nearest Neighbor Algorithm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilizando k = 1 para o conjunto teste:</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>modelo_final <span class="ot">=</span> FNN<span class="sc">::</span><span class="fu">knn</span>(<span class="at">train =</span> Treino, <span class="at">test =</span> teste, <span class="at">cl =</span> Treino_label, <span class="at">k =</span> <span class="dv">1</span>)</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtendo a matriz de confusão e demais medidas de avaliação:</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(modelo_final, <span class="fu">as.factor</span>(teste_label), <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 101  23
         1  15  10
                                          
               Accuracy : 0.745           
                 95% CI : (0.6672, 0.8128)
    No Information Rate : 0.7785          
    P-Value [Acc &gt; NIR] : 0.8605          
                                          
                  Kappa : 0.1902          
                                          
 Mcnemar's Test P-Value : 0.2561          
                                          
            Sensitivity : 0.30303         
            Specificity : 0.87069         
         Pos Pred Value : 0.40000         
         Neg Pred Value : 0.81452         
             Prevalence : 0.22148         
         Detection Rate : 0.06711         
   Detection Prevalence : 0.16779         
      Balanced Accuracy : 0.58686         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Repare que as medidas de avaliação do modelo não foram tão boas; o valor da precisão, particularmente, foi menor do que a taxa de não informação (No Information Rate), o que não deve acontecer. Sendo assim, esse não é o modelo ideal para essa base.</p>
<p>Vamos realizar o mesmo procedimento para os dados mas dessa vez vamos padronizá-los antes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando a padronização com a função preProcess() do pacote caret:</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>padronizacao <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">preProcess</span>(Treino, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando a padronização ao conjunto treino:</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>novo_treino <span class="ot">=</span> <span class="fu">predict</span>(padronizacao, Treino)</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando a padronização à validação:</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>nova_valid <span class="ot">=</span> <span class="fu">predict</span>(padronizacao, validacao)</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando a padronização ao teste:</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>novo_teste <span class="ot">=</span> <span class="fu">predict</span>(padronizacao, teste)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora vamos verificar qual é o melhor k:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>matrizes <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span>{</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">=</span> FNN<span class="sc">::</span><span class="fu">knn</span>(novo_treino, nova_valid, Treino_label, <span class="at">k =</span> i)</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>  matrizes[[i]] <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(modelo, <span class="fu">as.factor</span>(validacao_label), <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">21</span>) <span class="cf">break</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>matrizes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 88 36
         1 13 12
                                          
               Accuracy : 0.6711          
                 95% CI : (0.5895, 0.7458)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.607388        
                                          
                  Kappa : 0.1387          
                                          
 Mcnemar's Test P-Value : 0.001673        
                                          
            Sensitivity : 0.25000         
            Specificity : 0.87129         
         Pos Pred Value : 0.48000         
         Neg Pred Value : 0.70968         
             Prevalence : 0.32215         
         Detection Rate : 0.08054         
   Detection Prevalence : 0.16779         
      Balanced Accuracy : 0.56064         
                                          
       'Positive' Class : 1               
                                          

[[2]]
NULL

[[3]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 90 38
         1 11 10
                                          
               Accuracy : 0.6711          
                 95% CI : (0.5895, 0.7458)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.6073878       
                                          
                  Kappa : 0.1166          
                                          
 Mcnemar's Test P-Value : 0.0002038       
                                          
            Sensitivity : 0.20833         
            Specificity : 0.89109         
         Pos Pred Value : 0.47619         
         Neg Pred Value : 0.70312         
             Prevalence : 0.32215         
         Detection Rate : 0.06711         
   Detection Prevalence : 0.14094         
      Balanced Accuracy : 0.54971         
                                          
       'Positive' Class : 1               
                                          

[[4]]
NULL

[[5]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 96 38
         1  5 10
                                          
               Accuracy : 0.7114          
                 95% CI : (0.6316, 0.7826)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.2163          
                                          
                  Kappa : 0.1938          
                                          
 Mcnemar's Test P-Value : 1.061e-06       
                                          
            Sensitivity : 0.20833         
            Specificity : 0.95050         
         Pos Pred Value : 0.66667         
         Neg Pred Value : 0.71642         
             Prevalence : 0.32215         
         Detection Rate : 0.06711         
   Detection Prevalence : 0.10067         
      Balanced Accuracy : 0.57941         
                                          
       'Positive' Class : 1               
                                          

[[6]]
NULL

[[7]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 95 38
         1  6 10
                                          
               Accuracy : 0.7047          
                 95% CI : (0.6245, 0.7765)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.272           
                                          
                  Kappa : 0.1805          
                                          
 Mcnemar's Test P-Value : 2.962e-06       
                                          
            Sensitivity : 0.20833         
            Specificity : 0.94059         
         Pos Pred Value : 0.62500         
         Neg Pred Value : 0.71429         
             Prevalence : 0.32215         
         Detection Rate : 0.06711         
   Detection Prevalence : 0.10738         
      Balanced Accuracy : 0.57446         
                                          
       'Positive' Class : 1               
                                          

[[8]]
NULL

[[9]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 95 38
         1  6 10
                                          
               Accuracy : 0.7047          
                 95% CI : (0.6245, 0.7765)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.272           
                                          
                  Kappa : 0.1805          
                                          
 Mcnemar's Test P-Value : 2.962e-06       
                                          
            Sensitivity : 0.20833         
            Specificity : 0.94059         
         Pos Pred Value : 0.62500         
         Neg Pred Value : 0.71429         
             Prevalence : 0.32215         
         Detection Rate : 0.06711         
   Detection Prevalence : 0.10738         
      Balanced Accuracy : 0.57446         
                                          
       'Positive' Class : 1               
                                          

[[10]]
NULL

[[11]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 96 37
         1  5 11
                                          
               Accuracy : 0.7181          
                 95% CI : (0.6387, 0.7887)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.1676          
                                          
                  Kappa : 0.2177          
                                          
 Mcnemar's Test P-Value : 1.724e-06       
                                          
            Sensitivity : 0.22917         
            Specificity : 0.95050         
         Pos Pred Value : 0.68750         
         Neg Pred Value : 0.72180         
             Prevalence : 0.32215         
         Detection Rate : 0.07383         
   Detection Prevalence : 0.10738         
      Balanced Accuracy : 0.58983         
                                          
       'Positive' Class : 1               
                                          

[[12]]
NULL

[[13]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 96 37
         1  5 11
                                          
               Accuracy : 0.7181          
                 95% CI : (0.6387, 0.7887)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.1676          
                                          
                  Kappa : 0.2177          
                                          
 Mcnemar's Test P-Value : 1.724e-06       
                                          
            Sensitivity : 0.22917         
            Specificity : 0.95050         
         Pos Pred Value : 0.68750         
         Neg Pred Value : 0.72180         
             Prevalence : 0.32215         
         Detection Rate : 0.07383         
   Detection Prevalence : 0.10738         
      Balanced Accuracy : 0.58983         
                                          
       'Positive' Class : 1               
                                          

[[14]]
NULL

[[15]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 97 36
         1  4 12
                                          
               Accuracy : 0.7315          
                 95% CI : (0.6529, 0.8008)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.09284         
                                          
                  Kappa : 0.255           
                                          
 Mcnemar's Test P-Value : 9.509e-07       
                                          
            Sensitivity : 0.25000         
            Specificity : 0.96040         
         Pos Pred Value : 0.75000         
         Neg Pred Value : 0.72932         
             Prevalence : 0.32215         
         Detection Rate : 0.08054         
   Detection Prevalence : 0.10738         
      Balanced Accuracy : 0.60520         
                                          
       'Positive' Class : 1               
                                          

[[16]]
NULL

[[17]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 97 35
         1  4 13
                                        
               Accuracy : 0.7383        
                 95% CI : (0.66, 0.8068)
    No Information Rate : 0.6779        
    P-Value [Acc &gt; NIR] : 0.0662        
                                        
                  Kappa : 0.2784        
                                        
 Mcnemar's Test P-Value : 1.556e-06     
                                        
            Sensitivity : 0.27083       
            Specificity : 0.96040       
         Pos Pred Value : 0.76471       
         Neg Pred Value : 0.73485       
             Prevalence : 0.32215       
         Detection Rate : 0.08725       
   Detection Prevalence : 0.11409       
      Balanced Accuracy : 0.61561       
                                        
       'Positive' Class : 1             
                                        

[[18]]
NULL

[[19]]
Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 97 37
         1  4 11
                                          
               Accuracy : 0.7248          
                 95% CI : (0.6457, 0.7947)
    No Information Rate : 0.6779          
    P-Value [Acc &gt; NIR] : 0.1265          
                                          
                  Kappa : 0.2313          
                                          
 Mcnemar's Test P-Value : 5.806e-07       
                                          
            Sensitivity : 0.22917         
            Specificity : 0.96040         
         Pos Pred Value : 0.73333         
         Neg Pred Value : 0.72388         
             Prevalence : 0.32215         
         Detection Rate : 0.07383         
   Detection Prevalence : 0.10067         
      Balanced Accuracy : 0.59478         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Para o KNN é extremamente importante padronizarmos os dados antes, pois as medidas das variáveis geralmente estão em escalas diferentes, o que torna as distâncias entre os pontos distorcidas dos seus reais valores.</p>
<p>Podemos notar que, em geral, os modelos melhoraram nas sensibilidades e nas precisões. Vamos utilizar k = 17, que foi o modelo com maior sensibilidade (0,2708) e precisão (0,7383).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilizando k = 17 para o conjunto teste:</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>modelo_final <span class="ot">=</span> FNN<span class="sc">::</span><span class="fu">knn</span>(novo_treino, novo_teste, Treino_label, <span class="at">k =</span> <span class="dv">17</span>)</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtendo a matriz de confusão e demais medidas de avaliação:</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(modelo_final, <span class="fu">as.factor</span>(teste_label), <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 110  21
         1   6  12
                                          
               Accuracy : 0.8188          
                 95% CI : (0.7474, 0.8771)
    No Information Rate : 0.7785          
    P-Value [Acc &gt; NIR] : 0.138039        
                                          
                  Kappa : 0.3725          
                                          
 Mcnemar's Test P-Value : 0.007054        
                                          
            Sensitivity : 0.36364         
            Specificity : 0.94828         
         Pos Pred Value : 0.66667         
         Neg Pred Value : 0.83969         
             Prevalence : 0.22148         
         Detection Rate : 0.08054         
   Detection Prevalence : 0.12081         
      Balanced Accuracy : 0.65596         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Repare que a precisão melhorou muito (0,8188) e a sensibilidade foi um pouco maior, de 0,3636. Isso significa que 36,36% dos voluntários que doaram sangue em março de 2007 foram identificados.</p>
</section>
<section id="em-regressão-2" class="level4" data-number="11.2.3.2">
<h4 data-number="11.2.3.2" class="anchored" data-anchor-id="em-regressão-2"><span class="header-section-number">11.2.3.2</span> Em Regressão</h4>
<p>Vamos carregar a base de dados Computer_Hardware. Essa base contém algumas informações sobre hardwares de diferentes computadores, entre elas nossa variável de interesse, “PRP”, que representa o desempenho relativo publicado do computador. As demais variáveis são:</p>
<ul>
<li>MYCT: tempo de ciclo da máquina em nanossegundos;</li>
<li>MMIN: memória principal mínima em kilobytes;</li>
<li>MMAX: memória principal máxima em kilobytes;</li>
<li>CACH: memória do cachê em kilobytes;</li>
<li>CHMIN: canais mínimos em unidades;</li>
<li>CHMAX: canais máximos em unidades.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"Computer_Hardware.rds"</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   208 obs. of  7 variables:
 $ MYCT : int  29 29 29 29 26 23 23 23 23 400 ...
 $ MMIN : int  8000 8000 8000 8000 8000 16000 16000 16000 32000 1000 ...
 $ MMAX : int  32000 32000 32000 16000 32000 32000 32000 64000 64000 3000 ...
 $ CACH : int  32 32 32 32 64 64 64 64 128 0 ...
 $ CHMIN: int  8 8 8 8 8 16 16 16 32 1 ...
 $ CHMAX: int  32 32 32 16 32 32 32 32 64 2 ...
 $ PRP  : int  269 220 172 132 318 367 489 636 1144 38 ...</code></pre>
</div>
</div>
<p>Novamente temos todas as variáveis numéricas, então vamos prosseguir para a divisão em treino, validação e teste. Vamos separar 60% dos dados para treino, 20% para validação e 20% para teste.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>noTreino <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(<span class="at">y =</span> pc<span class="sc">$</span>PRP, <span class="at">p =</span> .<span class="dv">8</span>, <span class="at">list =</span> F)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>treino <span class="ot">=</span> pc[noTreino,]</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> pc[<span class="sc">-</span>noTreino,]</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos pegar 25% do treino para validação, pois 0,25*0,8 = 0,2 -&gt; 20% dos dados.</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>treino_indices <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(<span class="at">y =</span> treino<span class="sc">$</span>PRP, <span class="at">p =</span> <span class="fl">0.75</span>, <span class="at">list =</span> F)</span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>Treino <span class="ot">=</span> treino[treino_indices,]</span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>validacao <span class="ot">=</span> treino[<span class="sc">-</span>treino_indices,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Além disso, devemos separar os rótulos de cada conjunto e as suas variáveis explicativas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando o rótulo do conjunto treino:</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>Treino_label <span class="ot">=</span> Treino<span class="sc">$</span>PRP</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando apenas as variáveis explicativas do conjunto treino:</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>Treino <span class="ot">=</span> Treino <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>PRP)</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando o rótulo da validação:</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>validacao_label <span class="ot">=</span> validacao<span class="sc">$</span>PRP</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando apenas as variáveis explicativas da validação:</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>validacao <span class="ot">=</span> validacao <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>PRP)</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando o rótulo do conjunto teste:</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>teste_label <span class="ot">=</span> teste<span class="sc">$</span>PRP</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegando apenas as variáveis explicativas do conjunto teste:</span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> teste <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>PRP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como já comentado anteriormente, é extremamente importante padronizarmos os dados antes de aplicar o KNN, pois as variáveis se encontram em medidas diferentes e isso pode afetar drasticamente as predições do modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para padronizarmos utilizamos a função preProcess() do pacote caret:</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>padronizacao <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">preProcess</span>(Treino, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando a padronização ao treino:</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>novo_treino <span class="ot">=</span> <span class="fu">predict</span>(padronizacao, Treino)</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando a padronização à validação:</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>nova_valid <span class="ot">=</span> <span class="fu">predict</span>(padronizacao, validacao)</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando a padronização ao teste:</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>novo_teste <span class="ot">=</span> <span class="fu">predict</span>(padronizacao, teste)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como vamos aplicar o KNN para regressão, precisamos utilizar a função knn.reg() do pacote FNN. Essa função deve ser usada apenas para aplicar o KNN em modelos de regressão. Seus principais argumentos são:</p>
<ul>
<li>train: conjunto treino sem os rótulos;</li>
<li>test: conjunto teste sem os rótulos;</li>
<li>y: rótulos do conjunto treino;</li>
<li>k: valor de k (vizinhos) a serem utilizados.</li>
</ul>
<p>Para avaliação do modelo iremos utilizar a função defaultSummary() do pacote caret, que nos retornará os valores de RMSE, <span class="math inline">\(R^2\)</span> e MAE dos modelos. Como a base de dados é menor do que a utilizada para o problema de classificação, vamos utilizar os valores de k apenas até o valor 10. Como as saídas são numéricas, os valores pares de k também estão inclusos no intervalo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lista que conterá as medidas avaliativas de cada modelo:</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">=</span> FNN<span class="sc">::</span><span class="fu">knn.reg</span>(<span class="at">train =</span> novo_treino, <span class="at">test =</span> nova_valid, <span class="at">y =</span> Treino_label, <span class="at">k =</span> i)</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  modelos[[i]] <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">defaultSummary</span>(<span class="fu">data.frame</span>(<span class="at">obs =</span> validacao_label, <span class="at">pred =</span> modelo<span class="sc">$</span>pred))</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>modelos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
     RMSE  Rsquared       MAE 
44.649748  0.781243 31.550000 

[[2]]
     RMSE  Rsquared       MAE 
34.903080  0.858955 25.900000 

[[3]]
      RMSE   Rsquared        MAE 
36.6681060  0.8440494 26.1833333 

[[4]]
      RMSE   Rsquared        MAE 
39.8067205  0.8189399 26.6500000 

[[5]]
      RMSE   Rsquared        MAE 
40.6152311  0.8088914 26.5750000 

[[6]]
      RMSE   Rsquared        MAE 
42.0173245  0.7929419 27.2416667 

[[7]]
      RMSE   Rsquared        MAE 
38.2030691  0.8291316 26.2285714 

[[8]]
      RMSE   Rsquared        MAE 
40.9843482  0.8052173 27.5781250 

[[9]]
      RMSE   Rsquared        MAE 
39.7361902  0.8226082 26.8722222 

[[10]]
     RMSE  Rsquared       MAE 
37.558361  0.840617 25.845000 </code></pre>
</div>
</div>
<p>Podemos notar que o modelo que utiliza k = 2 obteve o menor RMSE e o maior <span class="math inline">\(R^2\)</span> dentre os modelos. O menor MAE ficou por conta do k = 10. Sendo assim, o modelo com k = 2 demonstrou ser o melhor para os dados. Então esse é o valor de k que iremos utilizar para a amostra teste.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando o KNN com k = 2 no conjunto teste:</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>modelo_final <span class="ot">=</span> FNN<span class="sc">::</span><span class="fu">knn.reg</span>(<span class="at">train =</span> novo_treino, <span class="at">test =</span> novo_teste, <span class="at">y =</span> Treino_label, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>modelo_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prediction:
 [1] 297.5 477.0  32.5  61.0  30.0  26.0  26.0  48.0 290.0 170.0  63.0  26.0
[13]  14.0  28.5 151.5 107.0  12.0  24.0  15.5  99.0  15.5  46.0 127.0 127.0
[25] 301.5 170.5 457.5  40.0 121.5  87.0  21.0  24.5  93.5 170.0 302.5  21.0
[37]  21.0  33.0  37.0  22.0</code></pre>
</div>
</div>
<p>Agora vamos avaliar o nosso modelo final. Para pegar apenas o vetor com as predições precisamos utilizar o comando “modelo_final$pred”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">defaultSummary</span>(<span class="fu">data.frame</span>(<span class="at">obs =</span> teste_label, <span class="at">pred =</span> modelo_final<span class="sc">$</span>pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
36.755697  0.908051 23.712500 </code></pre>
</div>
</div>
<p>Note que obtivemos um <span class="math inline">\(R^2\)</span> acima de 0,9 e o valor do MAE foi um pouco menor do que o do modelo aplicado na validação. O RMSE sofreu um leve aumento, mas como melhoramos 2 das 3 medidas do modelo, pode-se dizer que ele se saiu bem para os dados.</p>
</section>
<section id="knn-com-a-função-train-do-pacote-caret" class="level4" data-number="11.2.3.3">
<h4 data-number="11.2.3.3" class="anchored" data-anchor-id="knn-com-a-função-train-do-pacote-caret"><span class="header-section-number">11.2.3.3</span> KNN com a função train() do pacote caret</h4>
<p>Vamos usar a base de dados Sacramento do pacote caret. Ela contém informações sobre imóveis à venda em Sacramento, Califórnia. Queremos predizer o preço (price) do imóvel baseado no número de quartos (beds), banheiros (baths), tamanho (sqft) e localização (latitude e longitude).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret); <span class="fu">library</span>(dplyr)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Sacramento"</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="co"># por comodidade, vamos deixar apenas as variáveis que serão utilizadas </span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>Sacramento <span class="ot">=</span> Sacramento <span class="sc">%&gt;%</span> </span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beds, baths, sqft, latitude, longitude, price)</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fazendo a divisão treino teste</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1010</span>)</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>noTreino <span class="ot">=</span> <span class="fu">createDataPartition</span>(Sacramento<span class="sc">$</span>price, <span class="at">p=</span><span class="fl">0.7</span>, <span class="at">list=</span>F)</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>treino <span class="ot">=</span> Sacramento[noTreino,]</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">=</span> Sacramento[<span class="sc">-</span>noTreino,]</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(treino)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   beds baths sqft latitude longitude price
2     3     1 1167 38.47890 -121.4310 68212
4     2     1  852 38.61684 -121.4391 69307
5     2     1  797 38.51947 -121.4358 81900
6     3     1 1122 38.66260 -121.3278 89921
9     2     2  941 38.62119 -121.2706 94905
10    3     2 1146 38.70091 -121.4430 98937</code></pre>
</div>
</div>
<p>Note que a variância das variáveis são bem diferentes. Por exemplo, a variância de beds é 0.7873567 enquanto que a variância de sqft é 527601.7995051. Suponha que temos uma nova observação e vamos começar a calcular as distâncias. Seja a nova observação:</p>
<p>Então, calculando a distância euclidiana entre ela e a primeira observação do conjunto treino temos:</p>
<p><span class="math inline">\(\sqrt{(3-1)^2 + (1-1)^2 + (1167 - 836)^2 + (38.47 - 38.63)^2 + (-121.43 - (-121.43))^2} = ...\)</span></p>
<p>Perceba que a influência que a variavel sqft terá sob a distância é muito maior do que a da variavel beds ou longitude por exemplo. Isso pode ser resolvido ao padronizar os dados.</p>
<p>Ao utilizar o método KNN, os dados precisam ser padronizados por causa da influência no cálculo das distâncias.</p>
<p>Sabendo disso, podemos agora treinar nosso modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">32</span>)</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">train</span>(price <span class="sc">~</span> ., <span class="at">data =</span> treino, <span class="at">method =</span> <span class="st">"knn"</span>, <span class="at">tuneLength =</span> <span class="dv">10</span>,</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>), </span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>, <span class="at">number=</span><span class="dv">10</span>,<span class="at">repeats=</span><span class="dv">3</span>))</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>modelo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k-Nearest Neighbors 

655 samples
  5 predictor

Pre-processing: centered (5), scaled (5) 
Resampling: Cross-Validated (10 fold, repeated 3 times) 
Summary of sample sizes: 588, 588, 589, 590, 590, 590, ... 
Resampling results across tuning parameters:

  k   RMSE      Rsquared   MAE     
   5  83858.89  0.6169478  58564.48
   7  84351.64  0.6105358  58443.99
   9  84207.68  0.6124963  57963.02
  11  84140.90  0.6137614  58033.12
  13  85045.62  0.6064900  58873.68
  15  86106.78  0.5969789  59869.60
  17  86467.75  0.5949395  60504.63
  19  87061.35  0.5916483  61004.59
  21  87553.16  0.5879941  61280.41
  23  87757.07  0.5877060  61537.33

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was k = 5.</code></pre>
</div>
</div>
<p>Usando a função train() podemos indicar o valor de k utilizando o argumento tuneLength, onde dizemos uma quantidade n, ele constroi o modelos utilizando os n primeiros valores default e retorna o melhor k baseado na precisão (se for um problema de classificação) ou RMSE (se for um problema de regressão). Também podemos utilizar o tuneGrid = expand.grid(k=) passando um ou mais valores para k e ele testa todos e decide qual é o melhor com o mesmo critério do tuneLenght.</p>
<p>Podemos alterar o critério de escolha do k adicionando o argumento metric=“MAE” no train() por exemplo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="outros-metodos_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Como podemos ver, k=5 obteve a menor raiz do erro quadrático médio, portanto foi o k escolhido.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avaliando o preditor</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>predicao <span class="ot">=</span> <span class="fu">predict</span>(modelo, teste)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(predicao,teste<span class="sc">$</span>price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        RMSE     Rsquared          MAE 
7.918685e+04 5.920253e-01 5.874246e+04 </code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./metodos-de-treino-baseados-em-arvore.html" class="pagination-link" aria-label="Métodos de Treino Baseados em Árvore">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Métodos de Treino Baseados em Árvore</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./referencias.html" class="pagination-link" aria-label="Referências">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Referências</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Criação: Maqueise Pinheiro e Thaís Machado. <br> Orientação: Douglas Rodrigues (UFF) e Karina Yaginuma (UFF). <br> Colaboradores: Gabriel Miranda, Thiago Augusto, Luana Moreno e Guilherme Ceacero.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/CienciaDeDadosUFF/cienciadedadosuff2.github.io/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>